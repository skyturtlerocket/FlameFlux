{"ast":null,"code":"import React,{useEffect,useRef,useCallback,forwardRef,useImperativeHandle}from'react';import{getTileUrl,getIconSizeForSeverity,getSeverityBackgroundColor,getSeverityColorHex}from'../utils/helpers';import{jsx as _jsx}from\"react/jsx-runtime\";const MapComponent=/*#__PURE__*/forwardRef((_ref,ref)=>{let{fires,mapLayer,onFireClick,satelliteLayers,predictedPerimeterEnabled,predictedPerimeterData}=_ref;const mapRef=useRef(null);const mapInstanceRef=useRef(null);const markersRef=useRef([]);const polygonsRef=useRef([]);const satelliteMarkersRef=useRef([]);const heatmapLayerRef=useRef(null);const resizeObserverRef=useRef(null);const heatmapLoadedRef=useRef(false);const currentViewRef=useRef({center:[37.7749,-122.4194],zoom:10});// Load Leaflet Heatmap plugin\nconst loadHeatmapPlugin=useCallback(()=>{return new Promise(resolve=>{if(window.L&&window.L.heatLayer){resolve();return;}if(!document.querySelector('script[src*=\"leaflet-heat\"]')){const script=document.createElement('script');script.src='https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';script.onload=()=>{heatmapLoadedRef.current=true;resolve();};document.head.appendChild(script);}else{resolve();}});},[]);// Get marker color based on satellite and confidence\nconst getSatelliteMarkerColor=useCallback((satellite,confidence)=>{const baseColor=satellite==='VIIRS'?'#3b82f6':'#ef4444';// Blue for VIIRS, Red for MODIS\nconst opacity=Math.max(0.3,confidence/100);return{color:baseColor,opacity};},[]);// Get marker size based on confidence and intensity\nconst getSatelliteMarkerSize=useCallback((confidence,intensity)=>{const baseSize=8;const confidenceMultiplier=confidence/100;const intensityMultiplier=Math.min(2,intensity/100);return Math.max(6,baseSize*confidenceMultiplier*intensityMultiplier);},[]);// Add satellite markers to map\nconst addSatelliteMarkers=useCallback((map,L)=>{// Clear existing satellite markers\nsatelliteMarkersRef.current.forEach(marker=>map.removeLayer(marker));satelliteMarkersRef.current=[];// Add VIIRS markers\nif(satelliteLayers.viirs.enabled&&satelliteLayers.viewMode==='markers'){satelliteLayers.viirs.data.forEach(hotspot=>{const{color,opacity}=getSatelliteMarkerColor('VIIRS',hotspot.confidence);const size=getSatelliteMarkerSize(hotspot.confidence,hotspot.intensity);const marker=L.circleMarker([hotspot.latitude,hotspot.longitude],{radius:size,fillColor:color,color:color,weight:1,opacity:opacity,fillOpacity:opacity*0.8}).addTo(map);marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);satelliteMarkersRef.current.push(marker);});}// Add MODIS markers\nif(satelliteLayers.modis.enabled&&satelliteLayers.viewMode==='markers'){satelliteLayers.modis.data.forEach(hotspot=>{const{color,opacity}=getSatelliteMarkerColor('MODIS',hotspot.confidence);const size=getSatelliteMarkerSize(hotspot.confidence,hotspot.intensity);const marker=L.circleMarker([hotspot.latitude,hotspot.longitude],{radius:size,fillColor:color,color:color,weight:1,opacity:opacity,fillOpacity:opacity*0.8}).addTo(map);marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);satelliteMarkersRef.current.push(marker);});}},[satelliteLayers,getSatelliteMarkerColor,getSatelliteMarkerSize]);// Add heatmap layer\nconst addHeatmapLayer=useCallback(async(map,L)=>{if(!heatmapLoadedRef.current){await loadHeatmapPlugin();}// Remove existing heatmap\nif(heatmapLayerRef.current){map.removeLayer(heatmapLayerRef.current);heatmapLayerRef.current=null;}if(satelliteLayers.viewMode==='heatmap'&&(satelliteLayers.viirs.enabled||satelliteLayers.modis.enabled)){const heatmapData=[];// Add VIIRS data\nif(satelliteLayers.viirs.enabled){satelliteLayers.viirs.data.forEach(hotspot=>{const intensity=hotspot.confidence/100*(hotspot.intensity/200);heatmapData.push([hotspot.latitude,hotspot.longitude,intensity]);});}// Add MODIS data\nif(satelliteLayers.modis.enabled){satelliteLayers.modis.data.forEach(hotspot=>{const intensity=hotspot.confidence/100*(hotspot.intensity/200);heatmapData.push([hotspot.latitude,hotspot.longitude,intensity]);});}if(heatmapData.length>0){heatmapLayerRef.current=L.heatLayer(heatmapData,{radius:20,blur:15,maxZoom:17,gradient:{0.4:'blue',0.6:'cyan',0.7:'lime',0.8:'yellow',1.0:'red'}}).addTo(map);}}},[satelliteLayers,loadHeatmapPlugin]);const addFirePolygons=useCallback((map,L,fire)=>{const{geometry}=fire;try{if(geometry.type==='Polygon'){const coords=geometry.coordinates[0];if(!coords||coords.length<3){console.warn('Invalid polygon coordinates for fire:',fire.name);return;}const leafletCoords=coords.filter(coord=>Array.isArray(coord)&&coord.length>=2&&typeof coord[0]==='number'&&typeof coord[1]==='number'&&!isNaN(coord[0])&&!isNaN(coord[1])).map(coord=>[coord[1],coord[0]]);if(leafletCoords.length<3){console.warn('Not enough valid coordinates for polygon:',fire.name);return;}const polygon=L.polygon(leafletCoords,{color:'#ef4444',weight:2,opacity:0.8,fillColor:'#ef4444',fillOpacity:0.2}).addTo(map);polygonsRef.current.push(polygon);}else if(geometry.type==='MultiPolygon'){geometry.coordinates.forEach((polygonCoords,index)=>{const coords=polygonCoords[0];if(!coords||coords.length<3){console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);return;}const leafletCoords=coords.filter(coord=>Array.isArray(coord)&&coord.length>=2&&typeof coord[0]==='number'&&typeof coord[1]==='number'&&!isNaN(coord[0])&&!isNaN(coord[1])).map(coord=>[coord[1],coord[0]]);if(leafletCoords.length<3){console.warn(`Not enough valid coordinates for polygon ${index} of fire:`,fire.name);return;}const polygon=L.polygon(leafletCoords,{color:'#ef4444',weight:2,opacity:0.8,fillColor:'#ef4444',fillOpacity:0.2}).addTo(map);polygonsRef.current.push(polygon);});}}catch(error){console.error('Error adding fire polygon for',fire.name,':',error);}},[]);// Add predicted perimeter polygons\nconst addPredictedPerimeterPolygons=useCallback((map,L)=>{if(!predictedPerimeterEnabled||!predictedPerimeterData){console.log('Predicted perimeter not enabled or data missing');return;}if(!predictedPerimeterData.features){console.log('Predicted perimeter data has no features');return;}console.log('Adding predicted perimeter polygons:',predictedPerimeterData.features.length);predictedPerimeterData.features.forEach((feature,idx)=>{if(feature.geometry&&feature.geometry.type==='Polygon'){const coords=feature.geometry.coordinates[0];console.log(`Polygon #${idx} coords:`,coords);const leafletCoords=coords.map(coord=>[coord[1],coord[0]]);const polygon=L.polygon(leafletCoords,{color:'#60a5fa',// blue-400 (light blue)\nweight:2,opacity:0.8,fillColor:'#60a5fa',fillOpacity:0.3}).addTo(map);// Store the polygon reference\npolygonsRef.current.push(polygon);console.log(`Added predicted perimeter polygon #${idx}`);}else{console.log(`Feature #${idx} is not a Polygon or missing geometry`);}// Optionally handle MultiPolygon here\n});},[predictedPerimeterEnabled,predictedPerimeterData]);const addFireMarkers=useCallback((map,L)=>{// Clear existing markers and polygons\nmarkersRef.current.forEach(marker=>map.removeLayer(marker));polygonsRef.current.forEach(polygon=>map.removeLayer(polygon));markersRef.current=[];polygonsRef.current=[];// Add markers for each fire\nfires.forEach(fire=>{// Add polygon outlines\naddFirePolygons(map,L,fire);// Get icon configuration based on severity\nconst iconConfig=getIconSizeForSeverity(fire.severity);const backgroundColor=getSeverityBackgroundColor(fire.severity);// Create fire icon with dynamic sizing and color\nconst fireIcon=L.divIcon({html:`<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">ðŸ”¥</div>`,className:'fire-marker',iconSize:[iconConfig.size,iconConfig.size],iconAnchor:[iconConfig.size/2,iconConfig.size/2],popupAnchor:[0,-iconConfig.size/2]});// Add marker\nconst marker=L.marker([fire.lat,fire.lng],{icon:fireIcon}).addTo(map).bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n            <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n            <p style=\"margin: 2px 0;\">Containment: ${fire.containment?`${fire.containment}%`:'N/A'}</p>\n            <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n              Severity: ${fire.severity}\n            </p>\n            <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n              <button onclick=\"window.selectFire('${fire.id}')\" style=\"\n                background: #3b82f6;\n                color: white;\n                border: none;\n                padding: 4px 8px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 12px;\n              \">View Details</button>\n            </div>\n          </div>\n        `).on('click',()=>onFireClick(fire));markersRef.current.push(marker);});},[fires,onFireClick,addFirePolygons]);// Zoom to fire perimeter\nconst zoomToFire=useCallback(fire=>{console.log('zoomToFire called with:',fire);if(!mapInstanceRef.current||!fire.geometry){console.log('Early return - mapInstance:',!!mapInstanceRef.current,'geometry:',!!fire.geometry);return;}const L=window.L;try{console.log('Fire geometry type:',fire.geometry.type);if(fire.geometry.type==='Polygon'){const coords=fire.geometry.coordinates[0];console.log('Polygon coordinates:',coords);if(coords&&coords.length>=3){const leafletCoords=coords.filter(coord=>Array.isArray(coord)&&coord.length>=2&&typeof coord[0]==='number'&&typeof coord[1]==='number'&&!isNaN(coord[0])&&!isNaN(coord[1])).map(coord=>[coord[1],coord[0]]);console.log('Leaflet coordinates:',leafletCoords);if(leafletCoords.length>=3){const bounds=L.latLngBounds(leafletCoords);console.log('Fitting bounds:',bounds);mapInstanceRef.current.fitBounds(bounds,{padding:[20,20],maxZoom:15});}}}else if(fire.geometry.type==='MultiPolygon'){const allCoords=[];fire.geometry.coordinates.forEach(polygonCoords=>{const coords=polygonCoords[0];if(coords&&coords.length>=3){const leafletCoords=coords.filter(coord=>Array.isArray(coord)&&coord.length>=2&&typeof coord[0]==='number'&&typeof coord[1]==='number'&&!isNaN(coord[0])&&!isNaN(coord[1])).map(coord=>[coord[1],coord[0]]);allCoords.push(...leafletCoords);}});console.log('MultiPolygon all coordinates:',allCoords);if(allCoords.length>=3){const bounds=L.latLngBounds(allCoords);console.log('Fitting bounds:',bounds);mapInstanceRef.current.fitBounds(bounds,{padding:[20,20],maxZoom:15});}}}catch(error){console.error('Error zooming to fire:',error);}},[mapInstanceRef]);// Cleanup function\nconst cleanup=useCallback(()=>{// Disconnect resize observer\nif(resizeObserverRef.current){resizeObserverRef.current.disconnect();resizeObserverRef.current=null;}// Clean up markers and polygons\nif(mapInstanceRef.current){markersRef.current.forEach(marker=>{try{mapInstanceRef.current.removeLayer(marker);}catch(e){console.warn('Error removing marker:',e);}});polygonsRef.current.forEach(polygon=>{try{mapInstanceRef.current.removeLayer(polygon);}catch(e){console.warn('Error removing polygon:',e);}});// Clean up satellite markers\nsatelliteMarkersRef.current.forEach(marker=>{try{mapInstanceRef.current.removeLayer(marker);}catch(e){console.warn('Error removing satellite marker:',e);}});// Clean up heatmap layer\nif(heatmapLayerRef.current){try{mapInstanceRef.current.removeLayer(heatmapLayerRef.current);}catch(e){console.warn('Error removing heatmap layer:',e);}}}markersRef.current=[];polygonsRef.current=[];satelliteMarkersRef.current=[];heatmapLayerRef.current=null;// Remove map instance\nif(mapInstanceRef.current){try{mapInstanceRef.current.remove();}catch(e){console.warn('Error removing map:',e);}mapInstanceRef.current=null;}// Clean up global selectFire function\nif(window.selectFire){delete window.selectFire;}},[]);useEffect(()=>{const loadLeaflet=async()=>{try{// Adding CSS\nif(!document.querySelector('link[href*=\"leaflet\"]')){const link=document.createElement('link');link.rel='stylesheet';link.href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';document.head.appendChild(link);}// Loading Leaflet\nif(!window.L){const script=document.createElement('script');script.src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';script.onload=()=>{console.log('Leaflet loaded successfully');initializeMap();};script.onerror=()=>{console.error('Failed to load Leaflet');};document.head.appendChild(script);}else{initializeMap();}}catch(error){console.error('Error loading Leaflet:',error);}};const initializeMap=async()=>{// Clean up existing map first\ncleanup();if(!mapRef.current)return;try{const L=window.L;// Initialize the map with current view state\nconst map=L.map(mapRef.current,{center:currentViewRef.current.center,zoom:currentViewRef.current.zoom,zoomControl:false});// Add tile layer\nconst tileLayer=L.tileLayer(getTileUrl(mapLayer),{attribution:'&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'}).addTo(map);mapInstanceRef.current=map;mapInstanceRef.current.tileLayer=tileLayer;// Store current view when map moves\nmap.on('moveend',()=>{currentViewRef.current={center:map.getCenter(),zoom:map.getZoom()};});// Add fire markers when fires are loaded\nif(fires.length>0){addFireMarkers(map,L);}// Add satellite data\nif(satelliteLayers){addSatelliteMarkers(map,L);await addHeatmapLayer(map,L);}// Map resizing with proper error handling\nif(mapRef.current){resizeObserverRef.current=new ResizeObserver(()=>{try{if(mapInstanceRef.current&&mapRef.current){// Add a small delay to ensure DOM is ready\nsetTimeout(()=>{if(mapInstanceRef.current&&mapRef.current){mapInstanceRef.current.invalidateSize();}},50);}}catch(error){console.warn('Error during map resize:',error);}});resizeObserverRef.current.observe(mapRef.current);}console.log('Map initialized successfully');}catch(error){console.error('Error initializing map:',error);}};loadLeaflet();return cleanup;},[fires.length,mapLayer,addFireMarkers,cleanup,addSatelliteMarkers,addHeatmapLayer]);// Change tiles when map type changes\nuseEffect(()=>{if(mapInstanceRef.current&&mapInstanceRef.current.tileLayer){const L=window.L;try{mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);const newTileLayer=L.tileLayer(getTileUrl(mapLayer),{attribution:'&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'}).addTo(mapInstanceRef.current);mapInstanceRef.current.tileLayer=newTileLayer;}catch(error){console.error('Error changing tile layer:',error);}}},[mapLayer]);// Update markers when fires change\nuseEffect(()=>{if(mapInstanceRef.current&&window.L&&fires.length>0){try{addFireMarkers(mapInstanceRef.current,window.L);}catch(error){console.error('Error updating fire markers:',error);}}},[fires,addFireMarkers]);// Update satellite layers when they change\nuseEffect(()=>{if(mapInstanceRef.current&&window.L&&satelliteLayers){try{addSatelliteMarkers(mapInstanceRef.current,window.L);addHeatmapLayer(mapInstanceRef.current,window.L);}catch(error){console.error('Error updating satellite layers:',error);}}},[satelliteLayers,addSatelliteMarkers,addHeatmapLayer]);// Update polygons when fires or predicted perimeter changes\nuseEffect(()=>{if(mapInstanceRef.current&&window.L){try{// Clear existing polygons first\npolygonsRef.current.forEach(polygon=>{try{mapInstanceRef.current.removeLayer(polygon);}catch(e){console.warn('Error removing polygon:',e);}});polygonsRef.current=[];// Add fire polygons\nfires.forEach(fire=>{addFirePolygons(mapInstanceRef.current,window.L,fire);});// Add predicted perimeter polygons\naddPredictedPerimeterPolygons(mapInstanceRef.current,window.L);}catch(error){console.error('Error updating polygons:',error);}}},[fires,addFirePolygons,addPredictedPerimeterPolygons]);// Make selectFire global for popup buttons\nuseEffect(()=>{window.selectFire=fireId=>{try{const fire=fires.find(f=>f.id===fireId);if(fire){onFireClick(fire);}}catch(error){console.error('Error in selectFire:',error);}};window.zoomToFire=fireId=>{try{const fire=fires.find(f=>f.id===fireId);if(fire){zoomToFire(fire);}}catch(error){console.error('Error in zoomToFire:',error);}};return()=>{if(window.selectFire){delete window.selectFire;}if(window.zoomToFire){delete window.zoomToFire;}};},[fires,onFireClick,zoomToFire]);useImperativeHandle(ref,()=>({zoomToFire}));return/*#__PURE__*/_jsx(\"div\",{ref:mapRef,className:\"w-full h-full\",style:{minHeight:'500px'}});});export default MapComponent;","map":{"version":3,"names":["React","useEffect","useRef","useCallback","forwardRef","useImperativeHandle","getTileUrl","getIconSizeForSeverity","getSeverityBackgroundColor","getSeverityColorHex","jsx","_jsx","MapComponent","_ref","ref","fires","mapLayer","onFireClick","satelliteLayers","predictedPerimeterEnabled","predictedPerimeterData","mapRef","mapInstanceRef","markersRef","polygonsRef","satelliteMarkersRef","heatmapLayerRef","resizeObserverRef","heatmapLoadedRef","currentViewRef","center","zoom","loadHeatmapPlugin","Promise","resolve","window","L","heatLayer","document","querySelector","script","createElement","src","onload","current","head","appendChild","getSatelliteMarkerColor","satellite","confidence","baseColor","opacity","Math","max","color","getSatelliteMarkerSize","intensity","baseSize","confidenceMultiplier","intensityMultiplier","min","addSatelliteMarkers","map","forEach","marker","removeLayer","viirs","enabled","viewMode","data","hotspot","size","circleMarker","latitude","longitude","radius","fillColor","weight","fillOpacity","addTo","bindPopup","id","age","toFixed","push","modis","addHeatmapLayer","heatmapData","length","blur","maxZoom","gradient","addFirePolygons","fire","geometry","type","coords","coordinates","console","warn","name","leafletCoords","filter","coord","Array","isArray","isNaN","polygon","polygonCoords","index","error","addPredictedPerimeterPolygons","log","features","feature","idx","addFireMarkers","iconConfig","severity","backgroundColor","fireIcon","divIcon","html","fontSize","className","iconSize","iconAnchor","popupAnchor","lat","lng","icon","containment","on","zoomToFire","bounds","latLngBounds","fitBounds","padding","allCoords","cleanup","disconnect","e","remove","selectFire","loadLeaflet","link","rel","href","initializeMap","onerror","zoomControl","tileLayer","attribution","getCenter","getZoom","ResizeObserver","setTimeout","invalidateSize","observe","newTileLayer","fireId","find","f","style","minHeight"],"sources":["/Users/timothyha/firecast/frontend/src/components/MapComponent.jsx"],"sourcesContent":["import React, { useEffect, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { getTileUrl, getIconSizeForSeverity, getSeverityBackgroundColor, getSeverityColorHex } from '../utils/helpers';\n\nconst MapComponent = forwardRef(({ fires, mapLayer, onFireClick, satelliteLayers, predictedPerimeterEnabled, predictedPerimeterData }, ref) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const polygonsRef = useRef([]);\n  const satelliteMarkersRef = useRef([]);\n  const heatmapLayerRef = useRef(null);\n  const resizeObserverRef = useRef(null);\n  const heatmapLoadedRef = useRef(false);\n  const currentViewRef = useRef({ center: [37.7749, -122.4194], zoom: 10 });\n\n  // Load Leaflet Heatmap plugin\n  const loadHeatmapPlugin = useCallback(() => {\n    return new Promise((resolve) => {\n      if (window.L && window.L.heatLayer) {\n        resolve();\n        return;\n      }\n\n      if (!document.querySelector('script[src*=\"leaflet-heat\"]')) {\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';\n        script.onload = () => {\n          heatmapLoadedRef.current = true;\n          resolve();\n        };\n        document.head.appendChild(script);\n      } else {\n        resolve();\n      }\n    });\n  }, []);\n\n  // Get marker color based on satellite and confidence\n  const getSatelliteMarkerColor = useCallback((satellite, confidence) => {\n    const baseColor = satellite === 'VIIRS' ? '#3b82f6' : '#ef4444'; // Blue for VIIRS, Red for MODIS\n    const opacity = Math.max(0.3, confidence / 100);\n    return { color: baseColor, opacity };\n  }, []);\n\n  // Get marker size based on confidence and intensity\n  const getSatelliteMarkerSize = useCallback((confidence, intensity) => {\n    const baseSize = 8;\n    const confidenceMultiplier = confidence / 100;\n    const intensityMultiplier = Math.min(2, intensity / 100);\n    return Math.max(6, baseSize * confidenceMultiplier * intensityMultiplier);\n  }, []);\n\n  // Add satellite markers to map\n  const addSatelliteMarkers = useCallback((map, L) => {\n    // Clear existing satellite markers\n    satelliteMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    satelliteMarkersRef.current = [];\n\n    // Add VIIRS markers\n    if (satelliteLayers.viirs.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.viirs.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('VIIRS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n\n    // Add MODIS markers\n    if (satelliteLayers.modis.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.modis.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('MODIS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n  }, [satelliteLayers, getSatelliteMarkerColor, getSatelliteMarkerSize]);\n\n  // Add heatmap layer\n  const addHeatmapLayer = useCallback(async (map, L) => {\n    if (!heatmapLoadedRef.current) {\n      await loadHeatmapPlugin();\n    }\n\n    // Remove existing heatmap\n    if (heatmapLayerRef.current) {\n      map.removeLayer(heatmapLayerRef.current);\n      heatmapLayerRef.current = null;\n    }\n\n    if (satelliteLayers.viewMode === 'heatmap' && (satelliteLayers.viirs.enabled || satelliteLayers.modis.enabled)) {\n      const heatmapData = [];\n\n      // Add VIIRS data\n      if (satelliteLayers.viirs.enabled) {\n        satelliteLayers.viirs.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      // Add MODIS data\n      if (satelliteLayers.modis.enabled) {\n        satelliteLayers.modis.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      if (heatmapData.length > 0) {\n        heatmapLayerRef.current = L.heatLayer(heatmapData, {\n          radius: 20,\n          blur: 15,\n          maxZoom: 17,\n          gradient: {\n            0.4: 'blue',\n            0.6: 'cyan',\n            0.7: 'lime',\n            0.8: 'yellow',\n            1.0: 'red'\n          }\n        }).addTo(map);\n      }\n    }\n  }, [satelliteLayers, loadHeatmapPlugin]);\n\n  const addFirePolygons = useCallback((map, L, fire) => {\n    const { geometry } = fire;\n    \n    try {\n      if (geometry.type === 'Polygon') {\n        const coords = geometry.coordinates[0];\n        \n        if (!coords || coords.length < 3) {\n          console.warn('Invalid polygon coordinates for fire:', fire.name);\n          return;\n        }\n        \n        const leafletCoords = coords\n          .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                  typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                  !isNaN(coord[0]) && !isNaN(coord[1]))\n          .map(coord => [coord[1], coord[0]]);\n        \n        if (leafletCoords.length < 3) {\n          console.warn('Not enough valid coordinates for polygon:', fire.name);\n          return;\n        }\n        \n        const polygon = L.polygon(leafletCoords, {\n          color: '#ef4444',\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#ef4444',\n          fillOpacity: 0.2\n        }).addTo(map);\n        \n        polygonsRef.current.push(polygon);\n        \n      } else if (geometry.type === 'MultiPolygon') {\n        geometry.coordinates.forEach((polygonCoords, index) => {\n          const coords = polygonCoords[0];\n\n          if (!coords || coords.length < 3) {\n            console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);\n            return;\n          }\n\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' && \n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          if (leafletCoords.length < 3) {\n            console.warn(`Not enough valid coordinates for polygon ${index} of fire:`, fire.name);\n            return;\n          }\n          \n          const polygon = L.polygon(leafletCoords, {\n            color: '#ef4444',\n            weight: 2,\n            opacity: 0.8,\n            fillColor: '#ef4444',\n            fillOpacity: 0.2\n          }).addTo(map);\n          \n          polygonsRef.current.push(polygon);\n        });\n      }\n    } catch (error) {\n      console.error('Error adding fire polygon for', fire.name, ':', error);\n    }\n  }, []);\n\n  // Add predicted perimeter polygons\n  const addPredictedPerimeterPolygons = useCallback((map, L) => {\n    if (!predictedPerimeterEnabled || !predictedPerimeterData) {\n      console.log('Predicted perimeter not enabled or data missing');\n      return;\n    }\n    if (!predictedPerimeterData.features) {\n      console.log('Predicted perimeter data has no features');\n      return;\n    }\n    console.log('Adding predicted perimeter polygons:', predictedPerimeterData.features.length);\n    predictedPerimeterData.features.forEach((feature, idx) => {\n      if (feature.geometry && feature.geometry.type === 'Polygon') {\n        const coords = feature.geometry.coordinates[0];\n        console.log(`Polygon #${idx} coords:`, coords);\n        const leafletCoords = coords.map(coord => [coord[1], coord[0]]);\n        const polygon = L.polygon(leafletCoords, {\n          color: '#60a5fa', // blue-400 (light blue)\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#60a5fa',\n          fillOpacity: 0.3\n        }).addTo(map);\n        \n        // Store the polygon reference\n        polygonsRef.current.push(polygon);\n        console.log(`Added predicted perimeter polygon #${idx}`);\n      } else {\n        console.log(`Feature #${idx} is not a Polygon or missing geometry`);\n      }\n      // Optionally handle MultiPolygon here\n    });\n  }, [predictedPerimeterEnabled, predictedPerimeterData]);\n\n  const addFireMarkers = useCallback((map, L) => {\n    // Clear existing markers and polygons\n    markersRef.current.forEach(marker => map.removeLayer(marker));\n    polygonsRef.current.forEach(polygon => map.removeLayer(polygon));\n    markersRef.current = [];\n    polygonsRef.current = [];\n\n    // Add markers for each fire\n    fires.forEach(fire => {\n      // Add polygon outlines\n      addFirePolygons(map, L, fire);\n      \n      // Get icon configuration based on severity\n      const iconConfig = getIconSizeForSeverity(fire.severity);\n      const backgroundColor = getSeverityBackgroundColor(fire.severity);\n      \n      // Create fire icon with dynamic sizing and color\n      const fireIcon = L.divIcon({\n        html: `<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">ðŸ”¥</div>`,\n        className: 'fire-marker',\n        iconSize: [iconConfig.size, iconConfig.size],\n        iconAnchor: [iconConfig.size / 2, iconConfig.size / 2],\n        popupAnchor: [0, -iconConfig.size / 2]\n      });\n      \n      // Add marker\n      const marker = L.marker([fire.lat, fire.lng], { icon: fireIcon })\n        .addTo(map)\n        .bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n            <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n            <p style=\"margin: 2px 0;\">Containment: ${fire.containment ? `${fire.containment}%` : 'N/A'}</p>\n            <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n              Severity: ${fire.severity}\n            </p>\n            <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n              <button onclick=\"window.selectFire('${fire.id}')\" style=\"\n                background: #3b82f6;\n                color: white;\n                border: none;\n                padding: 4px 8px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 12px;\n              \">View Details</button>\n            </div>\n          </div>\n        `)\n        .on('click', () => onFireClick(fire));\n\n      markersRef.current.push(marker);\n    });\n  }, [fires, onFireClick, addFirePolygons]);\n\n  // Zoom to fire perimeter\n  const zoomToFire = useCallback((fire) => {\n    console.log('zoomToFire called with:', fire);\n    if (!mapInstanceRef.current || !fire.geometry) {\n      console.log('Early return - mapInstance:', !!mapInstanceRef.current, 'geometry:', !!fire.geometry);\n      return;\n    }\n\n    const L = window.L;\n    try {\n      console.log('Fire geometry type:', fire.geometry.type);\n      if (fire.geometry.type === 'Polygon') {\n        const coords = fire.geometry.coordinates[0];\n        console.log('Polygon coordinates:', coords);\n        if (coords && coords.length >= 3) {\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          console.log('Leaflet coordinates:', leafletCoords);\n          if (leafletCoords.length >= 3) {\n            const bounds = L.latLngBounds(leafletCoords);\n            console.log('Fitting bounds:', bounds);\n            mapInstanceRef.current.fitBounds(bounds, { \n              padding: [20, 20],\n              maxZoom: 15 \n            });\n          }\n        }\n      } else if (fire.geometry.type === 'MultiPolygon') {\n        const allCoords = [];\n        fire.geometry.coordinates.forEach(polygonCoords => {\n          const coords = polygonCoords[0];\n          if (coords && coords.length >= 3) {\n            const leafletCoords = coords\n              .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                      typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                      !isNaN(coord[0]) && !isNaN(coord[1]))\n              .map(coord => [coord[1], coord[0]]);\n            allCoords.push(...leafletCoords);\n          }\n        });\n        \n        console.log('MultiPolygon all coordinates:', allCoords);\n        if (allCoords.length >= 3) {\n          const bounds = L.latLngBounds(allCoords);\n          console.log('Fitting bounds:', bounds);\n          mapInstanceRef.current.fitBounds(bounds, { \n            padding: [20, 20],\n            maxZoom: 15 \n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error zooming to fire:', error);\n    }\n  }, [mapInstanceRef]);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    // Disconnect resize observer\n    if (resizeObserverRef.current) {\n      resizeObserverRef.current.disconnect();\n      resizeObserverRef.current = null;\n    }\n\n    // Clean up markers and polygons\n    if (mapInstanceRef.current) {\n      markersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing marker:', e);\n        }\n      });\n      \n      polygonsRef.current.forEach(polygon => {\n        try {\n          mapInstanceRef.current.removeLayer(polygon);\n        } catch (e) {\n          console.warn('Error removing polygon:', e);\n        }\n      });\n\n      // Clean up satellite markers\n      satelliteMarkersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing satellite marker:', e);\n        }\n      });\n\n      // Clean up heatmap layer\n      if (heatmapLayerRef.current) {\n        try {\n          mapInstanceRef.current.removeLayer(heatmapLayerRef.current);\n        } catch (e) {\n          console.warn('Error removing heatmap layer:', e);\n        }\n      }\n    }\n\n    markersRef.current = [];\n    polygonsRef.current = [];\n    satelliteMarkersRef.current = [];\n    heatmapLayerRef.current = null;\n\n    // Remove map instance\n    if (mapInstanceRef.current) {\n      try {\n        mapInstanceRef.current.remove();\n      } catch (e) {\n        console.warn('Error removing map:', e);\n      }\n      mapInstanceRef.current = null;\n    }\n\n    // Clean up global selectFire function\n    if (window.selectFire) {\n      delete window.selectFire;\n    }\n  }, []);\n\n  useEffect(() => {\n    const loadLeaflet = async () => {\n      try {\n        // Adding CSS\n        if (!document.querySelector('link[href*=\"leaflet\"]')) {\n          const link = document.createElement('link');\n          link.rel = 'stylesheet';\n          link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';\n          document.head.appendChild(link);\n        }\n\n        // Loading Leaflet\n        if (!window.L) {\n          const script = document.createElement('script');\n          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';\n          script.onload = () => {\n            console.log('Leaflet loaded successfully');\n            initializeMap();\n          };\n          script.onerror = () => {\n            console.error('Failed to load Leaflet');\n          };\n          document.head.appendChild(script);\n        } else {\n          initializeMap();\n        }\n      } catch (error) {\n        console.error('Error loading Leaflet:', error);\n      }\n    };\n\n    const initializeMap = async () => {\n      // Clean up existing map first\n      cleanup();\n\n      if (!mapRef.current) return;\n\n      try {\n        const L = window.L;\n        \n        // Initialize the map with current view state\n        const map = L.map(mapRef.current, {\n          center: currentViewRef.current.center,\n          zoom: currentViewRef.current.zoom,\n          zoomControl: false\n        });\n\n        // Add tile layer\n        const tileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n\n        mapInstanceRef.current = map;\n        mapInstanceRef.current.tileLayer = tileLayer;\n\n        // Store current view when map moves\n        map.on('moveend', () => {\n          currentViewRef.current = {\n            center: map.getCenter(),\n            zoom: map.getZoom()\n          };\n        });\n\n        // Add fire markers when fires are loaded\n        if (fires.length > 0) {\n          addFireMarkers(map, L);\n        }\n\n        // Add satellite data\n        if (satelliteLayers) {\n          addSatelliteMarkers(map, L);\n          await addHeatmapLayer(map, L);\n        }\n\n        // Map resizing with proper error handling\n        if (mapRef.current) {\n          resizeObserverRef.current = new ResizeObserver(() => {\n            try {\n              if (mapInstanceRef.current && mapRef.current) {\n                // Add a small delay to ensure DOM is ready\n                setTimeout(() => {\n                  if (mapInstanceRef.current && mapRef.current) {\n                    mapInstanceRef.current.invalidateSize();\n                  }\n                }, 50);\n              }\n            } catch (error) {\n              console.warn('Error during map resize:', error);\n            }\n          });\n          \n          resizeObserverRef.current.observe(mapRef.current);\n        }\n\n        console.log('Map initialized successfully');\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    };\n\n    loadLeaflet();\n\n    return cleanup;\n  }, [fires.length, mapLayer, addFireMarkers, cleanup, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Change tiles when map type changes\n  useEffect(() => {\n    if (mapInstanceRef.current && mapInstanceRef.current.tileLayer) {\n      const L = window.L;\n      try {\n        mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);\n        \n        const newTileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(mapInstanceRef.current);\n\n        mapInstanceRef.current.tileLayer = newTileLayer;\n      } catch (error) {\n        console.error('Error changing tile layer:', error);\n      }\n    }\n  }, [mapLayer]);\n\n  // Update markers when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && fires.length > 0) {\n      try {\n        addFireMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire markers:', error);\n      }\n    }\n  }, [fires, addFireMarkers]);\n\n  // Update satellite layers when they change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && satelliteLayers) {\n      try {\n        addSatelliteMarkers(mapInstanceRef.current, window.L);\n        addHeatmapLayer(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating satellite layers:', error);\n      }\n    }\n  }, [satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Update polygons when fires or predicted perimeter changes\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      try {\n        // Clear existing polygons first\n        polygonsRef.current.forEach(polygon => {\n          try {\n            mapInstanceRef.current.removeLayer(polygon);\n          } catch (e) {\n            console.warn('Error removing polygon:', e);\n          }\n        });\n        polygonsRef.current = [];\n\n        // Add fire polygons\n        fires.forEach(fire => {\n          addFirePolygons(mapInstanceRef.current, window.L, fire);\n        });\n\n        // Add predicted perimeter polygons\n        addPredictedPerimeterPolygons(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating polygons:', error);\n      }\n    }\n  }, [fires, addFirePolygons, addPredictedPerimeterPolygons]);\n\n  // Make selectFire global for popup buttons\n  useEffect(() => {\n    window.selectFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          onFireClick(fire);\n        }\n      } catch (error) {\n        console.error('Error in selectFire:', error);\n      }\n    };\n\n    window.zoomToFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          zoomToFire(fire);\n        }\n      } catch (error) {\n        console.error('Error in zoomToFire:', error);\n      }\n    };\n    \n    return () => {\n      if (window.selectFire) {\n        delete window.selectFire;\n      }\n      if (window.zoomToFire) {\n        delete window.zoomToFire;\n      }\n    };\n  }, [fires, onFireClick, zoomToFire]);\n\n  useImperativeHandle(ref, () => ({\n    zoomToFire,\n  }));\n\n  return (\n    <div \n      ref={mapRef} \n      className=\"w-full h-full\"\n      style={{ minHeight: '500px' }}\n    />\n  );\n});\n\nexport default MapComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}