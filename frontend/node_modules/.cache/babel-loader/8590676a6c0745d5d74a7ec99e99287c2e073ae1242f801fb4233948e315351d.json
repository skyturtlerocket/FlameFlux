{"ast":null,"code":"var _jsxFileName = \"/Users/timothyha/firecast/frontend/src/components/MapComponent.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { getTileUrl, getIconSizeForSeverity, getSeverityBackgroundColor, getSeverityColorHex, getProbabilityColor, hasPredictionCSV } from '../utils/helpers';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MapComponent = /*#__PURE__*/_s(/*#__PURE__*/forwardRef(_c = _s(({\n  fires,\n  mapLayer,\n  onFireClick,\n  satelliteLayers,\n  predictedPerimeterEnabled,\n  predictedPerimeterData,\n  firePredictionData\n}, ref) => {\n  _s();\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const polygonsRef = useRef([]);\n  const satelliteMarkersRef = useRef([]);\n  const predictionMarkersRef = useRef([]);\n  const heatmapLayerRef = useRef(null);\n  const resizeObserverRef = useRef(null);\n  const heatmapLoadedRef = useRef(false);\n  const currentViewRef = useRef({\n    center: [39.8283, -116.4194],\n    zoom: 5\n  });\n\n  // Load Leaflet Heatmap plugin\n  const loadHeatmapPlugin = useCallback(() => {\n    return new Promise(resolve => {\n      if (window.L && window.L.heatLayer) {\n        resolve();\n        return;\n      }\n      if (!document.querySelector('script[src*=\"leaflet-heat\"]')) {\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';\n        script.onload = () => {\n          heatmapLoadedRef.current = true;\n          resolve();\n        };\n        document.head.appendChild(script);\n      } else {\n        resolve();\n      }\n    });\n  }, []);\n\n  // Get marker color based on satellite and confidence\n  const getSatelliteMarkerColor = useCallback((satellite, confidence) => {\n    const baseColor = satellite === 'VIIRS' ? '#3b82f6' : '#ef4444'; // Blue for VIIRS, Red for MODIS\n    const opacity = Math.max(0.3, confidence / 100);\n    return {\n      color: baseColor,\n      opacity\n    };\n  }, []);\n\n  // Get marker size based on confidence and intensity\n  const getSatelliteMarkerSize = useCallback((confidence, intensity) => {\n    const baseSize = 8;\n    const confidenceMultiplier = confidence / 100;\n    const intensityMultiplier = Math.min(2, intensity / 100);\n    return Math.max(6, baseSize * confidenceMultiplier * intensityMultiplier);\n  }, []);\n\n  // Add satellite markers to map\n  const addSatelliteMarkers = useCallback((map, L) => {\n    // Clear existing satellite markers\n    satelliteMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    satelliteMarkersRef.current = [];\n\n    // Add VIIRS markers\n    if (satelliteLayers.viirs.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.viirs.data.forEach(hotspot => {\n        const {\n          color,\n          opacity\n        } = getSatelliteMarkerColor('VIIRS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n\n    // Add MODIS markers\n    if (satelliteLayers.modis.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.modis.data.forEach(hotspot => {\n        const {\n          color,\n          opacity\n        } = getSatelliteMarkerColor('MODIS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n  }, [satelliteLayers, getSatelliteMarkerColor, getSatelliteMarkerSize]);\n\n  // Add heatmap layer\n  const addHeatmapLayer = useCallback(async (map, L) => {\n    if (!heatmapLoadedRef.current) {\n      await loadHeatmapPlugin();\n    }\n\n    // Remove existing heatmap\n    if (heatmapLayerRef.current) {\n      map.removeLayer(heatmapLayerRef.current);\n      heatmapLayerRef.current = null;\n    }\n    if (satelliteLayers.viewMode === 'heatmap' && (satelliteLayers.viirs.enabled || satelliteLayers.modis.enabled)) {\n      const heatmapData = [];\n\n      // Add VIIRS data\n      if (satelliteLayers.viirs.enabled) {\n        satelliteLayers.viirs.data.forEach(hotspot => {\n          const intensity = hotspot.confidence / 100 * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      // Add MODIS data\n      if (satelliteLayers.modis.enabled) {\n        satelliteLayers.modis.data.forEach(hotspot => {\n          const intensity = hotspot.confidence / 100 * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n      if (heatmapData.length > 0) {\n        heatmapLayerRef.current = L.heatLayer(heatmapData, {\n          radius: 20,\n          blur: 15,\n          maxZoom: 17,\n          gradient: {\n            0.4: 'blue',\n            0.6: 'cyan',\n            0.7: 'lime',\n            0.8: 'yellow',\n            1.0: 'red'\n          }\n        }).addTo(map);\n      }\n    }\n  }, [satelliteLayers, loadHeatmapPlugin]);\n  const addFirePolygons = useCallback((map, L, fire) => {\n    const {\n      geometry\n    } = fire;\n    try {\n      if (geometry.type === 'Polygon') {\n        const coords = geometry.coordinates[0];\n        if (!coords || coords.length < 3) {\n          console.warn('Invalid polygon coordinates for fire:', fire.name);\n          return;\n        }\n        const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n        if (leafletCoords.length < 3) {\n          console.warn('Not enough valid coordinates for polygon:', fire.name);\n          return;\n        }\n        const polygon = L.polygon(leafletCoords, {\n          color: '#ef4444',\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#ef4444',\n          fillOpacity: 0.2\n        }).addTo(map);\n        polygonsRef.current.push(polygon);\n      } else if (geometry.type === 'MultiPolygon') {\n        geometry.coordinates.forEach((polygonCoords, index) => {\n          const coords = polygonCoords[0];\n          if (!coords || coords.length < 3) {\n            console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);\n            return;\n          }\n          const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n          if (leafletCoords.length < 3) {\n            console.warn(`Not enough valid coordinates for polygon ${index} of fire:`, fire.name);\n            return;\n          }\n          const polygon = L.polygon(leafletCoords, {\n            color: '#ef4444',\n            weight: 2,\n            opacity: 0.8,\n            fillColor: '#ef4444',\n            fillOpacity: 0.2\n          }).addTo(map);\n          polygonsRef.current.push(polygon);\n        });\n      }\n    } catch (error) {\n      console.error('Error adding fire polygon for', fire.name, ':', error);\n    }\n  }, []);\n\n  // Add fire prediction probability markers\n  const addFirePredictionMarkers = useCallback((map, L) => {\n    // Always clear existing prediction markers first\n    predictionMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    predictionMarkersRef.current = [];\n    if (!firePredictionData || !firePredictionData.length) {\n      console.log('No fire prediction data available - markers cleared');\n      return;\n    }\n    console.log('Adding fire prediction markers:', firePredictionData.length);\n    firePredictionData.forEach((point, idx) => {\n      const lat = parseFloat(point.lat);\n      const lon = parseFloat(point.lon);\n      const probability = parseFloat(point.predicted_prob);\n      if (isNaN(lat) || isNaN(lon) || isNaN(probability)) {\n        console.warn(`Invalid data point #${idx}:`, point);\n        return;\n      }\n\n      // Get color based on probability\n      const color = getProbabilityColor(probability);\n\n      // Create circle marker\n      const marker = L.circleMarker([lat, lon], {\n        radius: 4,\n        fillColor: color,\n        color: color,\n        weight: 1,\n        opacity: 0.8,\n        fillOpacity: 0.7\n      }).addTo(map);\n\n      // Add popup with probability information\n      marker.bindPopup(`\n        <div style=\"color: #374151; font-family: system-ui;\">\n          <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #dc2626;\">Fire Prediction</h3>\n          <p style=\"margin: 2px 0; font-size: 12px;\">Probability: ${(probability * 100).toFixed(1)}%</p>\n          <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${lat.toFixed(4)}, Lng: ${lon.toFixed(4)}</p>\n        </div>\n      `);\n      predictionMarkersRef.current.push(marker);\n    });\n    console.log(`Added ${predictionMarkersRef.current.length} prediction markers`);\n  }, [firePredictionData]);\n  const addFireMarkers = useCallback((map, L) => {\n    // Clear existing markers and polygons\n    markersRef.current.forEach(marker => map.removeLayer(marker));\n    polygonsRef.current.forEach(polygon => map.removeLayer(polygon));\n    markersRef.current = [];\n    polygonsRef.current = [];\n\n    // Add markers for each fire\n    fires.forEach(fire => {\n      // Add polygon outlines\n      addFirePolygons(map, L, fire);\n\n      // Get icon configuration based on severity\n      const iconConfig = getIconSizeForSeverity(fire.severity);\n      const backgroundColor = getSeverityBackgroundColor(fire.severity);\n\n      // Create fire icon with dynamic sizing and color\n      const fireIcon = L.divIcon({\n        html: `<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">ðŸ”¥</div>`,\n        className: 'fire-marker',\n        iconSize: [iconConfig.size, iconConfig.size],\n        iconAnchor: [iconConfig.size / 2, iconConfig.size / 2],\n        popupAnchor: [0, -iconConfig.size / 2]\n      });\n\n      // Add marker\n      const marker = L.marker([fire.lat, fire.lng], {\n        icon: fireIcon\n      }).addTo(map);\n      const basePopupHtml = `\n            <div style=\"color: #374151; font-family: system-ui;\">\n              <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n              <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n              <p style=\"margin: 2px 0;\">Containment: ${fire.containment !== null && fire.containment !== undefined ? `${fire.containment}%` : 'N/A'}</p>\n              <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n                Severity: ${fire.severity}\n              </p>\n            </div>\n          `;\n      marker.bindPopup(basePopupHtml).on('click', () => onFireClick(fire));\n\n      // If prediction CSV exists, augment popup with a View Prediction button\n      try {\n        hasPredictionCSV(fire.name).then(exists => {\n          if (!exists) return;\n          const popupHtml = `\n              <div style=\"color: #374151; font-family: system-ui;\">\n                <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n                <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n                <p style=\"margin: 2px 0;\">Containment: ${fire.containment !== null && fire.containment !== undefined ? `${fire.containment}%` : 'N/A'}</p>\n                <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n                  Severity: ${fire.severity}\n                </p>\n                <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n                  <button data-action=\"view-prediction\" style=\"\n                    background: #3b82f6;\n                    color: white;\n                    border: none;\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    font-size: 12px;\n                  \">View Prediction</button>\n                </div>\n              </div>`;\n          try {\n            const popup = marker.getPopup();\n            if (popup && popup.setContent) {\n              popup.setContent(popupHtml);\n            }\n          } catch (e) {/* no-op */}\n        });\n      } catch (e) {\n        // ignore\n      }\n\n      // Keep popup open when hovering popup content; close only when leaving both marker and popup\n      let isHoveringPopup = false;\n      marker.on('mouseover', () => {\n        try {\n          marker.openPopup();\n        } catch (e) {/* no-op */}\n      });\n      marker.on('popupopen', () => {\n        try {\n          const popup = marker.getPopup();\n          const container = popup && (popup.getElement ? popup.getElement() : popup._container);\n          if (container) {\n            // Sticky hover\n            container.addEventListener('mouseenter', () => {\n              isHoveringPopup = true;\n            });\n            container.addEventListener('mouseleave', () => {\n              isHoveringPopup = false;\n              setTimeout(() => {\n                if (!isHoveringPopup) {\n                  try {\n                    marker.closePopup();\n                  } catch (e) {}\n                }\n              }, 120);\n            });\n            // Wire up View Prediction button\n            const btn = container.querySelector('[data-action=\"view-prediction\"]');\n            if (btn) {\n              btn.addEventListener('click', ev => {\n                ev.preventDefault();\n                try {\n                  onFireClick(fire);\n                } catch {}\n              }, {\n                once: true\n              });\n            }\n          }\n        } catch (e) {/* no-op */}\n      });\n      marker.on('mouseout', () => {\n        setTimeout(() => {\n          if (!isHoveringPopup) {\n            try {\n              marker.closePopup();\n            } catch (e) {/* no-op */}\n          }\n        }, 120);\n      });\n      markersRef.current.push(marker);\n    });\n  }, [fires, onFireClick, addFirePolygons]);\n\n  // Zoom to fire perimeter\n  const zoomToFire = useCallback(fire => {\n    console.log('zoomToFire called with:', fire);\n    if (!mapInstanceRef.current || !fire.geometry) {\n      console.log('Early return - mapInstance:', !!mapInstanceRef.current, 'geometry:', !!fire.geometry);\n      return;\n    }\n    const L = window.L;\n    try {\n      console.log('Fire geometry type:', fire.geometry.type);\n      if (fire.geometry.type === 'Polygon') {\n        const coords = fire.geometry.coordinates[0];\n        console.log('Polygon coordinates:', coords);\n        if (coords && coords.length >= 3) {\n          const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n          console.log('Leaflet coordinates:', leafletCoords);\n          if (leafletCoords.length >= 3) {\n            const bounds = L.latLngBounds(leafletCoords);\n            console.log('Fitting bounds:', bounds);\n            mapInstanceRef.current.fitBounds(bounds, {\n              padding: [20, 20],\n              maxZoom: 15\n            });\n          }\n        }\n      } else if (fire.geometry.type === 'MultiPolygon') {\n        const allCoords = [];\n        fire.geometry.coordinates.forEach(polygonCoords => {\n          const coords = polygonCoords[0];\n          if (coords && coords.length >= 3) {\n            const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n            allCoords.push(...leafletCoords);\n          }\n        });\n        console.log('MultiPolygon all coordinates:', allCoords);\n        if (allCoords.length >= 3) {\n          const bounds = L.latLngBounds(allCoords);\n          console.log('Fitting bounds:', bounds);\n          mapInstanceRef.current.fitBounds(bounds, {\n            padding: [20, 20],\n            maxZoom: 15\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error zooming to fire:', error);\n    }\n  }, [mapInstanceRef]);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    // Disconnect resize observer\n    if (resizeObserverRef.current) {\n      resizeObserverRef.current.disconnect();\n      resizeObserverRef.current = null;\n    }\n\n    // Clean up markers and polygons\n    if (mapInstanceRef.current) {\n      markersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing marker:', e);\n        }\n      });\n      polygonsRef.current.forEach(polygon => {\n        try {\n          mapInstanceRef.current.removeLayer(polygon);\n        } catch (e) {\n          console.warn('Error removing polygon:', e);\n        }\n      });\n\n      // Clean up satellite markers\n      satelliteMarkersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing satellite marker:', e);\n        }\n      });\n\n      // Clean up heatmap layer\n      if (heatmapLayerRef.current) {\n        try {\n          mapInstanceRef.current.removeLayer(heatmapLayerRef.current);\n        } catch (e) {\n          console.warn('Error removing heatmap layer:', e);\n        }\n      }\n    }\n    markersRef.current = [];\n    polygonsRef.current = [];\n    satelliteMarkersRef.current = [];\n    heatmapLayerRef.current = null;\n\n    // Remove map instance\n    if (mapInstanceRef.current) {\n      try {\n        mapInstanceRef.current.remove();\n      } catch (e) {\n        console.warn('Error removing map:', e);\n      }\n      mapInstanceRef.current = null;\n    }\n\n    // Clean up global selectFire function\n    if (window.selectFire) {\n      delete window.selectFire;\n    }\n  }, []);\n  useEffect(() => {\n    const loadLeaflet = async () => {\n      try {\n        // Adding CSS\n        if (!document.querySelector('link[href*=\"leaflet\"]')) {\n          const link = document.createElement('link');\n          link.rel = 'stylesheet';\n          link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';\n          document.head.appendChild(link);\n        }\n\n        // Loading Leaflet\n        if (!window.L) {\n          const script = document.createElement('script');\n          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';\n          script.onload = () => {\n            console.log('Leaflet loaded successfully');\n            initializeMap();\n          };\n          script.onerror = () => {\n            console.error('Failed to load Leaflet');\n          };\n          document.head.appendChild(script);\n        } else {\n          initializeMap();\n        }\n      } catch (error) {\n        console.error('Error loading Leaflet:', error);\n      }\n    };\n    const initializeMap = async () => {\n      // Clean up existing map first\n      cleanup();\n      if (!mapRef.current) return;\n      try {\n        const L = window.L;\n\n        // Initialize the map with current view state\n        const map = L.map(mapRef.current, {\n          center: currentViewRef.current.center,\n          zoom: currentViewRef.current.zoom,\n          zoomControl: false\n        });\n\n        // Add tile layer\n        const tileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n        mapInstanceRef.current = map;\n        mapInstanceRef.current.tileLayer = tileLayer;\n\n        // Store current view when map moves\n        map.on('moveend', () => {\n          currentViewRef.current = {\n            center: map.getCenter(),\n            zoom: map.getZoom()\n          };\n        });\n\n        // Add fire markers when fires are loaded\n        if (fires.length > 0) {\n          addFireMarkers(map, L);\n        }\n\n        // Add satellite data\n        if (satelliteLayers) {\n          addSatelliteMarkers(map, L);\n          await addHeatmapLayer(map, L);\n        }\n\n        // Map resizing with proper error handling\n        if (mapRef.current) {\n          resizeObserverRef.current = new ResizeObserver(() => {\n            try {\n              if (mapInstanceRef.current && mapRef.current) {\n                // Add a small delay to ensure DOM is ready\n                setTimeout(() => {\n                  if (mapInstanceRef.current && mapRef.current) {\n                    mapInstanceRef.current.invalidateSize();\n                  }\n                }, 50);\n              }\n            } catch (error) {\n              console.warn('Error during map resize:', error);\n            }\n          });\n          resizeObserverRef.current.observe(mapRef.current);\n        }\n        console.log('Map initialized successfully');\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    };\n    loadLeaflet();\n    return cleanup;\n  }, [fires.length, mapLayer, addFireMarkers, cleanup, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Change tiles when map type changes\n  useEffect(() => {\n    if (mapInstanceRef.current && mapInstanceRef.current.tileLayer) {\n      const L = window.L;\n      try {\n        mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);\n        const newTileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(mapInstanceRef.current);\n        mapInstanceRef.current.tileLayer = newTileLayer;\n      } catch (error) {\n        console.error('Error changing tile layer:', error);\n      }\n    }\n  }, [mapLayer]);\n\n  // Update markers when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && fires.length > 0) {\n      try {\n        addFireMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire markers:', error);\n      }\n    }\n  }, [fires, addFireMarkers]);\n\n  // Update satellite layers when they change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && satelliteLayers) {\n      try {\n        addSatelliteMarkers(mapInstanceRef.current, window.L);\n        addHeatmapLayer(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating satellite layers:', error);\n      }\n    }\n  }, [satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Update polygons when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      try {\n        // Clear existing polygons first\n        polygonsRef.current.forEach(polygon => {\n          try {\n            mapInstanceRef.current.removeLayer(polygon);\n          } catch (e) {\n            console.warn('Error removing polygon:', e);\n          }\n        });\n        polygonsRef.current = [];\n\n        // Add fire polygons\n        fires.forEach(fire => {\n          addFirePolygons(mapInstanceRef.current, window.L, fire);\n        });\n      } catch (error) {\n        console.error('Error updating polygons:', error);\n      }\n    }\n  }, [fires, addFirePolygons]);\n\n  // Update fire prediction markers when data changes\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      try {\n        addFirePredictionMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire prediction markers:', error);\n      }\n    }\n  }, [firePredictionData, addFirePredictionMarkers]);\n\n  // Make selectFire global for popup buttons\n  useEffect(() => {\n    window.selectFire = fireId => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          onFireClick(fire);\n        }\n      } catch (error) {\n        console.error('Error in selectFire:', error);\n      }\n    };\n    window.zoomToFire = fireId => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          zoomToFire(fire);\n        }\n      } catch (error) {\n        console.error('Error in zoomToFire:', error);\n      }\n    };\n    return () => {\n      if (window.selectFire) {\n        delete window.selectFire;\n      }\n      if (window.zoomToFire) {\n        delete window.zoomToFire;\n      }\n    };\n  }, [fires, onFireClick, zoomToFire]);\n  useImperativeHandle(ref, () => ({\n    zoomToFire\n  }));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mapRef,\n    className: \"w-full h-full\",\n    style: {\n      minHeight: '500px'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 763,\n    columnNumber: 5\n  }, this);\n}, \"rWCi42L2Y6BI1muDvjTLLAZ2tFE=\")), \"rWCi42L2Y6BI1muDvjTLLAZ2tFE=\");\n_c2 = MapComponent;\nexport default MapComponent;\nvar _c, _c2;\n$RefreshReg$(_c, \"MapComponent$forwardRef\");\n$RefreshReg$(_c2, \"MapComponent\");","map":{"version":3,"names":["React","useEffect","useRef","useCallback","forwardRef","useImperativeHandle","getTileUrl","getIconSizeForSeverity","getSeverityBackgroundColor","getSeverityColorHex","getProbabilityColor","hasPredictionCSV","jsxDEV","_jsxDEV","MapComponent","_s","_c","fires","mapLayer","onFireClick","satelliteLayers","predictedPerimeterEnabled","predictedPerimeterData","firePredictionData","ref","mapRef","mapInstanceRef","markersRef","polygonsRef","satelliteMarkersRef","predictionMarkersRef","heatmapLayerRef","resizeObserverRef","heatmapLoadedRef","currentViewRef","center","zoom","loadHeatmapPlugin","Promise","resolve","window","L","heatLayer","document","querySelector","script","createElement","src","onload","current","head","appendChild","getSatelliteMarkerColor","satellite","confidence","baseColor","opacity","Math","max","color","getSatelliteMarkerSize","intensity","baseSize","confidenceMultiplier","intensityMultiplier","min","addSatelliteMarkers","map","forEach","marker","removeLayer","viirs","enabled","viewMode","data","hotspot","size","circleMarker","latitude","longitude","radius","fillColor","weight","fillOpacity","addTo","bindPopup","id","age","toFixed","push","modis","addHeatmapLayer","heatmapData","length","blur","maxZoom","gradient","addFirePolygons","fire","geometry","type","coords","coordinates","console","warn","name","leafletCoords","filter","coord","Array","isArray","isNaN","polygon","polygonCoords","index","error","addFirePredictionMarkers","log","point","idx","lat","parseFloat","lon","probability","predicted_prob","addFireMarkers","iconConfig","severity","backgroundColor","fireIcon","divIcon","html","fontSize","className","iconSize","iconAnchor","popupAnchor","lng","icon","basePopupHtml","containment","undefined","on","then","exists","popupHtml","popup","getPopup","setContent","e","isHoveringPopup","openPopup","container","getElement","_container","addEventListener","setTimeout","closePopup","btn","ev","preventDefault","once","zoomToFire","bounds","latLngBounds","fitBounds","padding","allCoords","cleanup","disconnect","remove","selectFire","loadLeaflet","link","rel","href","initializeMap","onerror","zoomControl","tileLayer","attribution","getCenter","getZoom","ResizeObserver","invalidateSize","observe","newTileLayer","fireId","find","f","style","minHeight","fileName","_jsxFileName","lineNumber","columnNumber","_c2","$RefreshReg$"],"sources":["/Users/timothyha/firecast/frontend/src/components/MapComponent.jsx"],"sourcesContent":["import React, { useEffect, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { getTileUrl, getIconSizeForSeverity, getSeverityBackgroundColor, getSeverityColorHex, getProbabilityColor, hasPredictionCSV } from '../utils/helpers';\n\nconst MapComponent = forwardRef(({ fires, mapLayer, onFireClick, satelliteLayers, predictedPerimeterEnabled, predictedPerimeterData, firePredictionData }, ref) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const polygonsRef = useRef([]);\n  const satelliteMarkersRef = useRef([]);\n  const predictionMarkersRef = useRef([]);\n  const heatmapLayerRef = useRef(null);\n  const resizeObserverRef = useRef(null);\n  const heatmapLoadedRef = useRef(false);\n  const currentViewRef = useRef({ center: [39.8283, -116.4194], zoom: 5 });\n\n  // Load Leaflet Heatmap plugin\n  const loadHeatmapPlugin = useCallback(() => {\n    return new Promise((resolve) => {\n      if (window.L && window.L.heatLayer) {\n        resolve();\n        return;\n      }\n\n      if (!document.querySelector('script[src*=\"leaflet-heat\"]')) {\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';\n        script.onload = () => {\n          heatmapLoadedRef.current = true;\n          resolve();\n        };\n        document.head.appendChild(script);\n      } else {\n        resolve();\n      }\n    });\n  }, []);\n\n  // Get marker color based on satellite and confidence\n  const getSatelliteMarkerColor = useCallback((satellite, confidence) => {\n    const baseColor = satellite === 'VIIRS' ? '#3b82f6' : '#ef4444'; // Blue for VIIRS, Red for MODIS\n    const opacity = Math.max(0.3, confidence / 100);\n    return { color: baseColor, opacity };\n  }, []);\n\n  // Get marker size based on confidence and intensity\n  const getSatelliteMarkerSize = useCallback((confidence, intensity) => {\n    const baseSize = 8;\n    const confidenceMultiplier = confidence / 100;\n    const intensityMultiplier = Math.min(2, intensity / 100);\n    return Math.max(6, baseSize * confidenceMultiplier * intensityMultiplier);\n  }, []);\n\n  // Add satellite markers to map\n  const addSatelliteMarkers = useCallback((map, L) => {\n    // Clear existing satellite markers\n    satelliteMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    satelliteMarkersRef.current = [];\n\n    // Add VIIRS markers\n    if (satelliteLayers.viirs.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.viirs.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('VIIRS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n\n    // Add MODIS markers\n    if (satelliteLayers.modis.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.modis.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('MODIS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n  }, [satelliteLayers, getSatelliteMarkerColor, getSatelliteMarkerSize]);\n\n  // Add heatmap layer\n  const addHeatmapLayer = useCallback(async (map, L) => {\n    if (!heatmapLoadedRef.current) {\n      await loadHeatmapPlugin();\n    }\n\n    // Remove existing heatmap\n    if (heatmapLayerRef.current) {\n      map.removeLayer(heatmapLayerRef.current);\n      heatmapLayerRef.current = null;\n    }\n\n    if (satelliteLayers.viewMode === 'heatmap' && (satelliteLayers.viirs.enabled || satelliteLayers.modis.enabled)) {\n      const heatmapData = [];\n\n      // Add VIIRS data\n      if (satelliteLayers.viirs.enabled) {\n        satelliteLayers.viirs.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      // Add MODIS data\n      if (satelliteLayers.modis.enabled) {\n        satelliteLayers.modis.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      if (heatmapData.length > 0) {\n        heatmapLayerRef.current = L.heatLayer(heatmapData, {\n          radius: 20,\n          blur: 15,\n          maxZoom: 17,\n          gradient: {\n            0.4: 'blue',\n            0.6: 'cyan',\n            0.7: 'lime',\n            0.8: 'yellow',\n            1.0: 'red'\n          }\n        }).addTo(map);\n      }\n    }\n  }, [satelliteLayers, loadHeatmapPlugin]);\n\n  const addFirePolygons = useCallback((map, L, fire) => {\n    const { geometry } = fire;\n    \n    try {\n      if (geometry.type === 'Polygon') {\n        const coords = geometry.coordinates[0];\n        \n        if (!coords || coords.length < 3) {\n          console.warn('Invalid polygon coordinates for fire:', fire.name);\n          return;\n        }\n        \n        const leafletCoords = coords\n          .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                  typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                  !isNaN(coord[0]) && !isNaN(coord[1]))\n          .map(coord => [coord[1], coord[0]]);\n        \n        if (leafletCoords.length < 3) {\n          console.warn('Not enough valid coordinates for polygon:', fire.name);\n          return;\n        }\n        \n        const polygon = L.polygon(leafletCoords, {\n          color: '#ef4444',\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#ef4444',\n          fillOpacity: 0.2\n        }).addTo(map);\n        \n        polygonsRef.current.push(polygon);\n        \n      } else if (geometry.type === 'MultiPolygon') {\n        geometry.coordinates.forEach((polygonCoords, index) => {\n          const coords = polygonCoords[0];\n\n          if (!coords || coords.length < 3) {\n            console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);\n            return;\n          }\n\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' && \n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          if (leafletCoords.length < 3) {\n            console.warn(`Not enough valid coordinates for polygon ${index} of fire:`, fire.name);\n            return;\n          }\n          \n          const polygon = L.polygon(leafletCoords, {\n            color: '#ef4444',\n            weight: 2,\n            opacity: 0.8,\n            fillColor: '#ef4444',\n            fillOpacity: 0.2\n          }).addTo(map);\n          \n          polygonsRef.current.push(polygon);\n        });\n      }\n    } catch (error) {\n      console.error('Error adding fire polygon for', fire.name, ':', error);\n    }\n  }, []);\n\n  // Add fire prediction probability markers\n  const addFirePredictionMarkers = useCallback((map, L) => {\n    // Always clear existing prediction markers first\n    predictionMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    predictionMarkersRef.current = [];\n    \n    if (!firePredictionData || !firePredictionData.length) {\n      console.log('No fire prediction data available - markers cleared');\n      return;\n    }\n    \n    console.log('Adding fire prediction markers:', firePredictionData.length);\n    \n    firePredictionData.forEach((point, idx) => {\n      const lat = parseFloat(point.lat);\n      const lon = parseFloat(point.lon);\n      const probability = parseFloat(point.predicted_prob);\n      \n      if (isNaN(lat) || isNaN(lon) || isNaN(probability)) {\n        console.warn(`Invalid data point #${idx}:`, point);\n        return;\n      }\n      \n      // Get color based on probability\n      const color = getProbabilityColor(probability);\n      \n      // Create circle marker\n      const marker = L.circleMarker([lat, lon], {\n        radius: 4,\n        fillColor: color,\n        color: color,\n        weight: 1,\n        opacity: 0.8,\n        fillOpacity: 0.7\n      }).addTo(map);\n      \n      // Add popup with probability information\n      marker.bindPopup(`\n        <div style=\"color: #374151; font-family: system-ui;\">\n          <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #dc2626;\">Fire Prediction</h3>\n          <p style=\"margin: 2px 0; font-size: 12px;\">Probability: ${(probability * 100).toFixed(1)}%</p>\n          <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${lat.toFixed(4)}, Lng: ${lon.toFixed(4)}</p>\n        </div>\n      `);\n      \n      predictionMarkersRef.current.push(marker);\n    });\n    \n    console.log(`Added ${predictionMarkersRef.current.length} prediction markers`);\n  }, [firePredictionData]);\n\n  const addFireMarkers = useCallback((map, L) => {\n    // Clear existing markers and polygons\n    markersRef.current.forEach(marker => map.removeLayer(marker));\n    polygonsRef.current.forEach(polygon => map.removeLayer(polygon));\n    markersRef.current = [];\n    polygonsRef.current = [];\n\n    // Add markers for each fire\n    fires.forEach(fire => {\n      // Add polygon outlines\n      addFirePolygons(map, L, fire);\n      \n      // Get icon configuration based on severity\n      const iconConfig = getIconSizeForSeverity(fire.severity);\n      const backgroundColor = getSeverityBackgroundColor(fire.severity);\n      \n      // Create fire icon with dynamic sizing and color\n      const fireIcon = L.divIcon({\n        html: `<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">ðŸ”¥</div>`,\n        className: 'fire-marker',\n        iconSize: [iconConfig.size, iconConfig.size],\n        iconAnchor: [iconConfig.size / 2, iconConfig.size / 2],\n        popupAnchor: [0, -iconConfig.size / 2]\n      });\n      \n      // Add marker\n      const marker = L.marker([fire.lat, fire.lng], { icon: fireIcon })\n        .addTo(map);\n\n      const basePopupHtml = `\n            <div style=\"color: #374151; font-family: system-ui;\">\n              <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n              <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n              <p style=\"margin: 2px 0;\">Containment: ${fire.containment !== null && fire.containment !== undefined ? `${fire.containment}%` : 'N/A'}</p>\n              <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n                Severity: ${fire.severity}\n              </p>\n            </div>\n          `;\n\n      marker.bindPopup(basePopupHtml)\n        .on('click', () => onFireClick(fire));\n\n        // If prediction CSV exists, augment popup with a View Prediction button\n        try {\n          hasPredictionCSV(fire.name).then((exists) => {\n            if (!exists) return;\n            const popupHtml = `\n              <div style=\"color: #374151; font-family: system-ui;\">\n                <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n                <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n                <p style=\"margin: 2px 0;\">Containment: ${fire.containment !== null && fire.containment !== undefined ? `${fire.containment}%` : 'N/A'}</p>\n                <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n                  Severity: ${fire.severity}\n                </p>\n                <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n                  <button data-action=\"view-prediction\" style=\"\n                    background: #3b82f6;\n                    color: white;\n                    border: none;\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    font-size: 12px;\n                  \">View Prediction</button>\n                </div>\n              </div>`;\n            try {\n              const popup = marker.getPopup();\n              if (popup && popup.setContent) {\n                popup.setContent(popupHtml);\n              }\n            } catch (e) { /* no-op */ }\n          });\n        } catch (e) {\n          // ignore\n        }\n\n        // Keep popup open when hovering popup content; close only when leaving both marker and popup\n        let isHoveringPopup = false;\n        marker.on('mouseover', () => {\n          try { marker.openPopup(); } catch (e) { /* no-op */ }\n        });\n        marker.on('popupopen', () => {\n          try {\n            const popup = marker.getPopup();\n            const container = popup && (popup.getElement ? popup.getElement() : popup._container);\n            if (container) {\n              // Sticky hover\n              container.addEventListener('mouseenter', () => { isHoveringPopup = true; });\n              container.addEventListener('mouseleave', () => {\n                isHoveringPopup = false;\n                setTimeout(() => { if (!isHoveringPopup) { try { marker.closePopup(); } catch (e) {} } }, 120);\n              });\n              // Wire up View Prediction button\n              const btn = container.querySelector('[data-action=\"view-prediction\"]');\n              if (btn) {\n                btn.addEventListener('click', (ev) => {\n                  ev.preventDefault();\n                  try { onFireClick(fire); } catch {}\n                }, { once: true });\n              }\n            }\n          } catch (e) { /* no-op */ }\n        });\n        marker.on('mouseout', () => {\n          setTimeout(() => {\n            if (!isHoveringPopup) {\n              try { marker.closePopup(); } catch (e) { /* no-op */ }\n            }\n          }, 120);\n        });\n\n      markersRef.current.push(marker);\n    });\n  }, [fires, onFireClick, addFirePolygons]);\n\n  // Zoom to fire perimeter\n  const zoomToFire = useCallback((fire) => {\n    console.log('zoomToFire called with:', fire);\n    if (!mapInstanceRef.current || !fire.geometry) {\n      console.log('Early return - mapInstance:', !!mapInstanceRef.current, 'geometry:', !!fire.geometry);\n      return;\n    }\n\n    const L = window.L;\n    try {\n      console.log('Fire geometry type:', fire.geometry.type);\n      if (fire.geometry.type === 'Polygon') {\n        const coords = fire.geometry.coordinates[0];\n        console.log('Polygon coordinates:', coords);\n        if (coords && coords.length >= 3) {\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          console.log('Leaflet coordinates:', leafletCoords);\n          if (leafletCoords.length >= 3) {\n            const bounds = L.latLngBounds(leafletCoords);\n            console.log('Fitting bounds:', bounds);\n            mapInstanceRef.current.fitBounds(bounds, { \n              padding: [20, 20],\n              maxZoom: 15 \n            });\n          }\n        }\n      } else if (fire.geometry.type === 'MultiPolygon') {\n        const allCoords = [];\n        fire.geometry.coordinates.forEach(polygonCoords => {\n          const coords = polygonCoords[0];\n          if (coords && coords.length >= 3) {\n            const leafletCoords = coords\n              .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                      typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                      !isNaN(coord[0]) && !isNaN(coord[1]))\n              .map(coord => [coord[1], coord[0]]);\n            allCoords.push(...leafletCoords);\n          }\n        });\n        \n        console.log('MultiPolygon all coordinates:', allCoords);\n        if (allCoords.length >= 3) {\n          const bounds = L.latLngBounds(allCoords);\n          console.log('Fitting bounds:', bounds);\n          mapInstanceRef.current.fitBounds(bounds, { \n            padding: [20, 20],\n            maxZoom: 15 \n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error zooming to fire:', error);\n    }\n  }, [mapInstanceRef]);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    // Disconnect resize observer\n    if (resizeObserverRef.current) {\n      resizeObserverRef.current.disconnect();\n      resizeObserverRef.current = null;\n    }\n\n    // Clean up markers and polygons\n    if (mapInstanceRef.current) {\n      markersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing marker:', e);\n        }\n      });\n      \n      polygonsRef.current.forEach(polygon => {\n        try {\n          mapInstanceRef.current.removeLayer(polygon);\n        } catch (e) {\n          console.warn('Error removing polygon:', e);\n        }\n      });\n\n      // Clean up satellite markers\n      satelliteMarkersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing satellite marker:', e);\n        }\n      });\n\n      // Clean up heatmap layer\n      if (heatmapLayerRef.current) {\n        try {\n          mapInstanceRef.current.removeLayer(heatmapLayerRef.current);\n        } catch (e) {\n          console.warn('Error removing heatmap layer:', e);\n        }\n      }\n    }\n\n    markersRef.current = [];\n    polygonsRef.current = [];\n    satelliteMarkersRef.current = [];\n    heatmapLayerRef.current = null;\n\n    // Remove map instance\n    if (mapInstanceRef.current) {\n      try {\n        mapInstanceRef.current.remove();\n      } catch (e) {\n        console.warn('Error removing map:', e);\n      }\n      mapInstanceRef.current = null;\n    }\n\n    // Clean up global selectFire function\n    if (window.selectFire) {\n      delete window.selectFire;\n    }\n  }, []);\n\n  useEffect(() => {\n    const loadLeaflet = async () => {\n      try {\n        // Adding CSS\n        if (!document.querySelector('link[href*=\"leaflet\"]')) {\n          const link = document.createElement('link');\n          link.rel = 'stylesheet';\n          link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';\n          document.head.appendChild(link);\n        }\n\n        // Loading Leaflet\n        if (!window.L) {\n          const script = document.createElement('script');\n          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';\n          script.onload = () => {\n            console.log('Leaflet loaded successfully');\n            initializeMap();\n          };\n          script.onerror = () => {\n            console.error('Failed to load Leaflet');\n          };\n          document.head.appendChild(script);\n        } else {\n          initializeMap();\n        }\n      } catch (error) {\n        console.error('Error loading Leaflet:', error);\n      }\n    };\n\n    const initializeMap = async () => {\n      // Clean up existing map first\n      cleanup();\n\n      if (!mapRef.current) return;\n\n      try {\n        const L = window.L;\n        \n        // Initialize the map with current view state\n        const map = L.map(mapRef.current, {\n          center: currentViewRef.current.center,\n          zoom: currentViewRef.current.zoom,\n          zoomControl: false\n        });\n\n        // Add tile layer\n        const tileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n\n        mapInstanceRef.current = map;\n        mapInstanceRef.current.tileLayer = tileLayer;\n\n        // Store current view when map moves\n        map.on('moveend', () => {\n          currentViewRef.current = {\n            center: map.getCenter(),\n            zoom: map.getZoom()\n          };\n        });\n\n        // Add fire markers when fires are loaded\n        if (fires.length > 0) {\n          addFireMarkers(map, L);\n        }\n\n        // Add satellite data\n        if (satelliteLayers) {\n          addSatelliteMarkers(map, L);\n          await addHeatmapLayer(map, L);\n        }\n\n        // Map resizing with proper error handling\n        if (mapRef.current) {\n          resizeObserverRef.current = new ResizeObserver(() => {\n            try {\n              if (mapInstanceRef.current && mapRef.current) {\n                // Add a small delay to ensure DOM is ready\n                setTimeout(() => {\n                  if (mapInstanceRef.current && mapRef.current) {\n                    mapInstanceRef.current.invalidateSize();\n                  }\n                }, 50);\n              }\n            } catch (error) {\n              console.warn('Error during map resize:', error);\n            }\n          });\n          \n          resizeObserverRef.current.observe(mapRef.current);\n        }\n\n        console.log('Map initialized successfully');\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    };\n\n    loadLeaflet();\n\n    return cleanup;\n  }, [fires.length, mapLayer, addFireMarkers, cleanup, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Change tiles when map type changes\n  useEffect(() => {\n    if (mapInstanceRef.current && mapInstanceRef.current.tileLayer) {\n      const L = window.L;\n      try {\n        mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);\n        \n        const newTileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(mapInstanceRef.current);\n\n        mapInstanceRef.current.tileLayer = newTileLayer;\n      } catch (error) {\n        console.error('Error changing tile layer:', error);\n      }\n    }\n  }, [mapLayer]);\n\n  // Update markers when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && fires.length > 0) {\n      try {\n        addFireMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire markers:', error);\n      }\n    }\n  }, [fires, addFireMarkers]);\n\n  // Update satellite layers when they change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && satelliteLayers) {\n      try {\n        addSatelliteMarkers(mapInstanceRef.current, window.L);\n        addHeatmapLayer(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating satellite layers:', error);\n      }\n    }\n  }, [satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Update polygons when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      try {\n        // Clear existing polygons first\n        polygonsRef.current.forEach(polygon => {\n          try {\n            mapInstanceRef.current.removeLayer(polygon);\n          } catch (e) {\n            console.warn('Error removing polygon:', e);\n          }\n        });\n        polygonsRef.current = [];\n\n        // Add fire polygons\n        fires.forEach(fire => {\n          addFirePolygons(mapInstanceRef.current, window.L, fire);\n        });\n      } catch (error) {\n        console.error('Error updating polygons:', error);\n      }\n    }\n  }, [fires, addFirePolygons]);\n\n  // Update fire prediction markers when data changes\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      try {\n        addFirePredictionMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire prediction markers:', error);\n      }\n    }\n  }, [firePredictionData, addFirePredictionMarkers]);\n\n  // Make selectFire global for popup buttons\n  useEffect(() => {\n    window.selectFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          onFireClick(fire);\n        }\n      } catch (error) {\n        console.error('Error in selectFire:', error);\n      }\n    };\n\n    window.zoomToFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          zoomToFire(fire);\n        }\n      } catch (error) {\n        console.error('Error in zoomToFire:', error);\n      }\n    };\n    \n    return () => {\n      if (window.selectFire) {\n        delete window.selectFire;\n      }\n      if (window.zoomToFire) {\n        delete window.zoomToFire;\n      }\n    };\n  }, [fires, onFireClick, zoomToFire]);\n\n  useImperativeHandle(ref, () => ({\n    zoomToFire,\n  }));\n\n  return (\n    <div \n      ref={mapRef} \n      className=\"w-full h-full\"\n      style={{ minHeight: '500px' }}\n    />\n  );\n});\n\nexport default MapComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}