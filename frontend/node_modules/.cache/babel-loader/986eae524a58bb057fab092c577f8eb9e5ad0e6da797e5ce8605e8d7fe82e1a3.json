{"ast":null,"code":"var _jsxFileName = \"/Users/timothyha/firecast/frontend/src/components/MapComponent.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { getTileUrl, getIconSizeForSeverity, getSeverityBackgroundColor, getSeverityColorHex } from '../utils/helpers';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MapComponent = /*#__PURE__*/_s(/*#__PURE__*/forwardRef(_c = _s(({\n  fires,\n  mapLayer,\n  onFireClick,\n  satelliteLayers\n}, ref) => {\n  _s();\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const polygonsRef = useRef([]);\n  const satelliteMarkersRef = useRef([]);\n  const heatmapLayerRef = useRef(null);\n  const resizeObserverRef = useRef(null);\n  const heatmapLoadedRef = useRef(false);\n\n  // Load Leaflet Heatmap plugin\n  const loadHeatmapPlugin = useCallback(() => {\n    return new Promise(resolve => {\n      if (window.L && window.L.heatLayer) {\n        resolve();\n        return;\n      }\n      if (!document.querySelector('script[src*=\"leaflet-heat\"]')) {\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';\n        script.onload = () => {\n          heatmapLoadedRef.current = true;\n          resolve();\n        };\n        document.head.appendChild(script);\n      } else {\n        resolve();\n      }\n    });\n  }, []);\n\n  // Get marker color based on satellite and confidence\n  const getSatelliteMarkerColor = useCallback((satellite, confidence) => {\n    const baseColor = satellite === 'VIIRS' ? '#3b82f6' : '#ef4444'; // Blue for VIIRS, Red for MODIS\n    const opacity = Math.max(0.3, confidence / 100);\n    return {\n      color: baseColor,\n      opacity\n    };\n  }, []);\n\n  // Get marker size based on confidence and intensity\n  const getSatelliteMarkerSize = useCallback((confidence, intensity) => {\n    const baseSize = 8;\n    const confidenceMultiplier = confidence / 100;\n    const intensityMultiplier = Math.min(2, intensity / 100);\n    return Math.max(6, baseSize * confidenceMultiplier * intensityMultiplier);\n  }, []);\n\n  // Add satellite markers to map\n  const addSatelliteMarkers = useCallback((map, L) => {\n    // Clear existing satellite markers\n    satelliteMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    satelliteMarkersRef.current = [];\n\n    // Add VIIRS markers\n    if (satelliteLayers.viirs.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.viirs.data.forEach(hotspot => {\n        const {\n          color,\n          opacity\n        } = getSatelliteMarkerColor('VIIRS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n\n    // Add MODIS markers\n    if (satelliteLayers.modis.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.modis.data.forEach(hotspot => {\n        const {\n          color,\n          opacity\n        } = getSatelliteMarkerColor('MODIS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n  }, [satelliteLayers, getSatelliteMarkerColor, getSatelliteMarkerSize]);\n\n  // Add heatmap layer\n  const addHeatmapLayer = useCallback(async (map, L) => {\n    if (!heatmapLoadedRef.current) {\n      await loadHeatmapPlugin();\n    }\n\n    // Remove existing heatmap\n    if (heatmapLayerRef.current) {\n      map.removeLayer(heatmapLayerRef.current);\n      heatmapLayerRef.current = null;\n    }\n    if (satelliteLayers.viewMode === 'heatmap' && (satelliteLayers.viirs.enabled || satelliteLayers.modis.enabled)) {\n      const heatmapData = [];\n\n      // Add VIIRS data\n      if (satelliteLayers.viirs.enabled) {\n        satelliteLayers.viirs.data.forEach(hotspot => {\n          const intensity = hotspot.confidence / 100 * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      // Add MODIS data\n      if (satelliteLayers.modis.enabled) {\n        satelliteLayers.modis.data.forEach(hotspot => {\n          const intensity = hotspot.confidence / 100 * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n      if (heatmapData.length > 0) {\n        heatmapLayerRef.current = L.heatLayer(heatmapData, {\n          radius: 20,\n          blur: 15,\n          maxZoom: 17,\n          gradient: {\n            0.4: 'blue',\n            0.6: 'cyan',\n            0.7: 'lime',\n            0.8: 'yellow',\n            1.0: 'red'\n          }\n        }).addTo(map);\n      }\n    }\n  }, [satelliteLayers, loadHeatmapPlugin]);\n  const addFirePolygons = useCallback((map, L, fire) => {\n    const {\n      geometry\n    } = fire;\n    try {\n      if (geometry.type === 'Polygon') {\n        const coords = geometry.coordinates[0];\n        if (!coords || coords.length < 3) {\n          console.warn('Invalid polygon coordinates for fire:', fire.name);\n          return;\n        }\n        const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n        if (leafletCoords.length < 3) {\n          console.warn('Not enough valid coordinates for polygon:', fire.name);\n          return;\n        }\n        const polygon = L.polygon(leafletCoords, {\n          color: '#ef4444',\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#ef4444',\n          fillOpacity: 0.2\n        }).addTo(map);\n        polygonsRef.current.push(polygon);\n      } else if (geometry.type === 'MultiPolygon') {\n        geometry.coordinates.forEach((polygonCoords, index) => {\n          const coords = polygonCoords[0];\n          if (!coords || coords.length < 3) {\n            console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);\n            return;\n          }\n          const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n          if (leafletCoords.length < 3) {\n            console.warn(`Not enough valid coordinates for polygon ${index} of fire:`, fire.name);\n            return;\n          }\n          const polygon = L.polygon(leafletCoords, {\n            color: '#ef4444',\n            weight: 2,\n            opacity: 0.8,\n            fillColor: '#ef4444',\n            fillOpacity: 0.2\n          }).addTo(map);\n          polygonsRef.current.push(polygon);\n        });\n      }\n    } catch (error) {\n      console.error('Error adding fire polygon for', fire.name, ':', error);\n    }\n  }, []);\n  const addFireMarkers = useCallback((map, L) => {\n    // Clear existing markers and polygons\n    markersRef.current.forEach(marker => map.removeLayer(marker));\n    polygonsRef.current.forEach(polygon => map.removeLayer(polygon));\n    markersRef.current = [];\n    polygonsRef.current = [];\n\n    // Add markers for each fire\n    fires.forEach(fire => {\n      // Add polygon outlines\n      addFirePolygons(map, L, fire);\n\n      // Get icon configuration based on severity\n      const iconConfig = getIconSizeForSeverity(fire.severity);\n      const backgroundColor = getSeverityBackgroundColor(fire.severity);\n\n      // Create fire icon with dynamic sizing and color\n      const fireIcon = L.divIcon({\n        html: `<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">🔥</div>`,\n        className: 'fire-marker',\n        iconSize: [iconConfig.size, iconConfig.size],\n        iconAnchor: [iconConfig.size / 2, iconConfig.size / 2],\n        popupAnchor: [0, -iconConfig.size / 2]\n      });\n\n      // Add marker\n      const marker = L.marker([fire.lat, fire.lng], {\n        icon: fireIcon\n      }).addTo(map).bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n            <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n            <p style=\"margin: 2px 0;\">Containment: ${fire.containment ? `${fire.containment}%` : 'N/A'}</p>\n            <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n              Severity: ${fire.severity}\n            </p>\n            <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n              <button onclick=\"window.selectFire('${fire.id}')\" style=\"\n                background: #3b82f6;\n                color: white;\n                border: none;\n                padding: 4px 8px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 12px;\n              \">View Details</button>\n            </div>\n          </div>\n        `).on('click', () => onFireClick(fire));\n      markersRef.current.push(marker);\n    });\n  }, [fires, onFireClick, addFirePolygons]);\n\n  // Zoom to fire perimeter\n  const zoomToFire = useCallback(fire => {\n    console.log('zoomToFire called with:', fire);\n    if (!mapInstanceRef.current || !fire.geometry) {\n      console.log('Early return - mapInstance:', !!mapInstanceRef.current, 'geometry:', !!fire.geometry);\n      return;\n    }\n    const L = window.L;\n    try {\n      console.log('Fire geometry type:', fire.geometry.type);\n      if (fire.geometry.type === 'Polygon') {\n        const coords = fire.geometry.coordinates[0];\n        console.log('Polygon coordinates:', coords);\n        if (coords && coords.length >= 3) {\n          const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n          console.log('Leaflet coordinates:', leafletCoords);\n          if (leafletCoords.length >= 3) {\n            const bounds = L.latLngBounds(leafletCoords);\n            console.log('Fitting bounds:', bounds);\n            mapInstanceRef.current.fitBounds(bounds, {\n              padding: [20, 20],\n              maxZoom: 15\n            });\n          }\n        }\n      } else if (fire.geometry.type === 'MultiPolygon') {\n        const allCoords = [];\n        fire.geometry.coordinates.forEach(polygonCoords => {\n          const coords = polygonCoords[0];\n          if (coords && coords.length >= 3) {\n            const leafletCoords = coords.filter(coord => Array.isArray(coord) && coord.length >= 2 && typeof coord[0] === 'number' && typeof coord[1] === 'number' && !isNaN(coord[0]) && !isNaN(coord[1])).map(coord => [coord[1], coord[0]]);\n            allCoords.push(...leafletCoords);\n          }\n        });\n        console.log('MultiPolygon all coordinates:', allCoords);\n        if (allCoords.length >= 3) {\n          const bounds = L.latLngBounds(allCoords);\n          console.log('Fitting bounds:', bounds);\n          mapInstanceRef.current.fitBounds(bounds, {\n            padding: [20, 20],\n            maxZoom: 15\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error zooming to fire:', error);\n    }\n  }, [mapInstanceRef]);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    // Disconnect resize observer\n    if (resizeObserverRef.current) {\n      resizeObserverRef.current.disconnect();\n      resizeObserverRef.current = null;\n    }\n\n    // Clean up markers and polygons\n    if (mapInstanceRef.current) {\n      markersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing marker:', e);\n        }\n      });\n      polygonsRef.current.forEach(polygon => {\n        try {\n          mapInstanceRef.current.removeLayer(polygon);\n        } catch (e) {\n          console.warn('Error removing polygon:', e);\n        }\n      });\n\n      // Clean up satellite markers\n      satelliteMarkersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing satellite marker:', e);\n        }\n      });\n\n      // Clean up heatmap layer\n      if (heatmapLayerRef.current) {\n        try {\n          mapInstanceRef.current.removeLayer(heatmapLayerRef.current);\n        } catch (e) {\n          console.warn('Error removing heatmap layer:', e);\n        }\n      }\n    }\n    markersRef.current = [];\n    polygonsRef.current = [];\n    satelliteMarkersRef.current = [];\n    heatmapLayerRef.current = null;\n\n    // Remove map instance\n    if (mapInstanceRef.current) {\n      try {\n        mapInstanceRef.current.remove();\n      } catch (e) {\n        console.warn('Error removing map:', e);\n      }\n      mapInstanceRef.current = null;\n    }\n\n    // Clean up global selectFire function\n    if (window.selectFire) {\n      delete window.selectFire;\n    }\n  }, []);\n  useEffect(() => {\n    const loadLeaflet = async () => {\n      try {\n        // Adding CSS\n        if (!document.querySelector('link[href*=\"leaflet\"]')) {\n          const link = document.createElement('link');\n          link.rel = 'stylesheet';\n          link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';\n          document.head.appendChild(link);\n        }\n\n        // Loading Leaflet\n        if (!window.L) {\n          const script = document.createElement('script');\n          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';\n          script.onload = () => {\n            console.log('Leaflet loaded successfully');\n            initializeMap();\n          };\n          script.onerror = () => {\n            console.error('Failed to load Leaflet');\n          };\n          document.head.appendChild(script);\n        } else {\n          initializeMap();\n        }\n      } catch (error) {\n        console.error('Error loading Leaflet:', error);\n      }\n    };\n    const initializeMap = async () => {\n      // Clean up existing map first\n      cleanup();\n      if (!mapRef.current) return;\n      try {\n        const L = window.L;\n\n        // Initialize the map in San Francisco Bay Area\n        const map = L.map(mapRef.current, {\n          center: [37.7749, -122.4194],\n          zoom: 10,\n          zoomControl: false\n        });\n\n        // Add tile layer\n        const tileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n        mapInstanceRef.current = map;\n        mapInstanceRef.current.tileLayer = tileLayer;\n\n        // Add fire markers when fires are loaded\n        if (fires.length > 0) {\n          addFireMarkers(map, L);\n        }\n\n        // Add satellite data\n        if (satelliteLayers) {\n          addSatelliteMarkers(map, L);\n          await addHeatmapLayer(map, L);\n        }\n\n        // Map resizing with proper error handling\n        if (mapRef.current) {\n          resizeObserverRef.current = new ResizeObserver(() => {\n            try {\n              if (mapInstanceRef.current && mapRef.current) {\n                // Add a small delay to ensure DOM is ready\n                setTimeout(() => {\n                  if (mapInstanceRef.current && mapRef.current) {\n                    mapInstanceRef.current.invalidateSize();\n                  }\n                }, 50);\n              }\n            } catch (error) {\n              console.warn('Error during map resize:', error);\n            }\n          });\n          resizeObserverRef.current.observe(mapRef.current);\n        }\n        console.log('Map initialized successfully');\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    };\n    loadLeaflet();\n    return cleanup;\n  }, [fires.length, mapLayer, addFireMarkers, cleanup, satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Change tiles when map type changes\n  useEffect(() => {\n    if (mapInstanceRef.current && mapInstanceRef.current.tileLayer) {\n      const L = window.L;\n      try {\n        mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);\n        const newTileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(mapInstanceRef.current);\n        mapInstanceRef.current.tileLayer = newTileLayer;\n      } catch (error) {\n        console.error('Error changing tile layer:', error);\n      }\n    }\n  }, [mapLayer]);\n\n  // Update markers when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && fires.length > 0) {\n      try {\n        addFireMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire markers:', error);\n      }\n    }\n  }, [fires, addFireMarkers]);\n\n  // Update satellite layers when they change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && satelliteLayers) {\n      try {\n        addSatelliteMarkers(mapInstanceRef.current, window.L);\n        addHeatmapLayer(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating satellite layers:', error);\n      }\n    }\n  }, [satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Make selectFire global for popup buttons\n  useEffect(() => {\n    window.selectFire = fireId => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          onFireClick(fire);\n        }\n      } catch (error) {\n        console.error('Error in selectFire:', error);\n      }\n    };\n    window.zoomToFire = fireId => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          zoomToFire(fire);\n        }\n      } catch (error) {\n        console.error('Error in zoomToFire:', error);\n      }\n    };\n    return () => {\n      if (window.selectFire) {\n        delete window.selectFire;\n      }\n      if (window.zoomToFire) {\n        delete window.zoomToFire;\n      }\n    };\n  }, [fires, onFireClick, zoomToFire]);\n  useImperativeHandle(ref, () => ({\n    zoomToFire\n  }));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mapRef,\n    className: \"w-full h-full\",\n    style: {\n      minHeight: '500px'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 605,\n    columnNumber: 5\n  }, this);\n}, \"+Jz2OSvo6HzgChim6WufyzG6x3I=\")), \"+Jz2OSvo6HzgChim6WufyzG6x3I=\");\n_c2 = MapComponent;\nexport default MapComponent;\nvar _c, _c2;\n$RefreshReg$(_c, \"MapComponent$forwardRef\");\n$RefreshReg$(_c2, \"MapComponent\");","map":{"version":3,"names":["React","useEffect","useRef","useCallback","forwardRef","useImperativeHandle","getTileUrl","getIconSizeForSeverity","getSeverityBackgroundColor","getSeverityColorHex","jsxDEV","_jsxDEV","MapComponent","_s","_c","fires","mapLayer","onFireClick","satelliteLayers","ref","mapRef","mapInstanceRef","markersRef","polygonsRef","satelliteMarkersRef","heatmapLayerRef","resizeObserverRef","heatmapLoadedRef","loadHeatmapPlugin","Promise","resolve","window","L","heatLayer","document","querySelector","script","createElement","src","onload","current","head","appendChild","getSatelliteMarkerColor","satellite","confidence","baseColor","opacity","Math","max","color","getSatelliteMarkerSize","intensity","baseSize","confidenceMultiplier","intensityMultiplier","min","addSatelliteMarkers","map","forEach","marker","removeLayer","viirs","enabled","viewMode","data","hotspot","size","circleMarker","latitude","longitude","radius","fillColor","weight","fillOpacity","addTo","bindPopup","id","age","toFixed","push","modis","addHeatmapLayer","heatmapData","length","blur","maxZoom","gradient","addFirePolygons","fire","geometry","type","coords","coordinates","console","warn","name","leafletCoords","filter","coord","Array","isArray","isNaN","polygon","polygonCoords","index","error","addFireMarkers","iconConfig","severity","backgroundColor","fireIcon","divIcon","html","fontSize","className","iconSize","iconAnchor","popupAnchor","lat","lng","icon","containment","on","zoomToFire","log","bounds","latLngBounds","fitBounds","padding","allCoords","cleanup","disconnect","e","remove","selectFire","loadLeaflet","link","rel","href","initializeMap","onerror","center","zoom","zoomControl","tileLayer","attribution","ResizeObserver","setTimeout","invalidateSize","observe","newTileLayer","fireId","find","f","style","minHeight","fileName","_jsxFileName","lineNumber","columnNumber","_c2","$RefreshReg$"],"sources":["/Users/timothyha/firecast/frontend/src/components/MapComponent.jsx"],"sourcesContent":["import React, { useEffect, useRef, useCallback, forwardRef, useImperativeHandle } from 'react';\nimport { getTileUrl, getIconSizeForSeverity, getSeverityBackgroundColor, getSeverityColorHex } from '../utils/helpers';\n\nconst MapComponent = forwardRef(({ fires, mapLayer, onFireClick, satelliteLayers }, ref) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const polygonsRef = useRef([]);\n  const satelliteMarkersRef = useRef([]);\n  const heatmapLayerRef = useRef(null);\n  const resizeObserverRef = useRef(null);\n  const heatmapLoadedRef = useRef(false);\n\n  // Load Leaflet Heatmap plugin\n  const loadHeatmapPlugin = useCallback(() => {\n    return new Promise((resolve) => {\n      if (window.L && window.L.heatLayer) {\n        resolve();\n        return;\n      }\n\n      if (!document.querySelector('script[src*=\"leaflet-heat\"]')) {\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js';\n        script.onload = () => {\n          heatmapLoadedRef.current = true;\n          resolve();\n        };\n        document.head.appendChild(script);\n      } else {\n        resolve();\n      }\n    });\n  }, []);\n\n  // Get marker color based on satellite and confidence\n  const getSatelliteMarkerColor = useCallback((satellite, confidence) => {\n    const baseColor = satellite === 'VIIRS' ? '#3b82f6' : '#ef4444'; // Blue for VIIRS, Red for MODIS\n    const opacity = Math.max(0.3, confidence / 100);\n    return { color: baseColor, opacity };\n  }, []);\n\n  // Get marker size based on confidence and intensity\n  const getSatelliteMarkerSize = useCallback((confidence, intensity) => {\n    const baseSize = 8;\n    const confidenceMultiplier = confidence / 100;\n    const intensityMultiplier = Math.min(2, intensity / 100);\n    return Math.max(6, baseSize * confidenceMultiplier * intensityMultiplier);\n  }, []);\n\n  // Add satellite markers to map\n  const addSatelliteMarkers = useCallback((map, L) => {\n    // Clear existing satellite markers\n    satelliteMarkersRef.current.forEach(marker => map.removeLayer(marker));\n    satelliteMarkersRef.current = [];\n\n    // Add VIIRS markers\n    if (satelliteLayers.viirs.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.viirs.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('VIIRS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #3b82f6;\">VIIRS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n\n    // Add MODIS markers\n    if (satelliteLayers.modis.enabled && satelliteLayers.viewMode === 'markers') {\n      satelliteLayers.modis.data.forEach(hotspot => {\n        const { color, opacity } = getSatelliteMarkerColor('MODIS', hotspot.confidence);\n        const size = getSatelliteMarkerSize(hotspot.confidence, hotspot.intensity);\n        \n        const marker = L.circleMarker([hotspot.latitude, hotspot.longitude], {\n          radius: size,\n          fillColor: color,\n          color: color,\n          weight: 1,\n          opacity: opacity,\n          fillOpacity: opacity * 0.8\n        }).addTo(map);\n\n        marker.bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 14px; margin: 0 0 8px 0; color: #ef4444;\">MODIS Hotspot</h3>\n            <p style=\"margin: 2px 0; font-size: 12px;\">ID: ${hotspot.id}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Confidence: ${hotspot.confidence}%</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Intensity: ${hotspot.intensity}</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Age: ${hotspot.age} hours</p>\n            <p style=\"margin: 2px 0; font-size: 12px;\">Lat: ${hotspot.latitude.toFixed(4)}, Lng: ${hotspot.longitude.toFixed(4)}</p>\n          </div>\n        `);\n\n        satelliteMarkersRef.current.push(marker);\n      });\n    }\n  }, [satelliteLayers, getSatelliteMarkerColor, getSatelliteMarkerSize]);\n\n  // Add heatmap layer\n  const addHeatmapLayer = useCallback(async (map, L) => {\n    if (!heatmapLoadedRef.current) {\n      await loadHeatmapPlugin();\n    }\n\n    // Remove existing heatmap\n    if (heatmapLayerRef.current) {\n      map.removeLayer(heatmapLayerRef.current);\n      heatmapLayerRef.current = null;\n    }\n\n    if (satelliteLayers.viewMode === 'heatmap' && (satelliteLayers.viirs.enabled || satelliteLayers.modis.enabled)) {\n      const heatmapData = [];\n\n      // Add VIIRS data\n      if (satelliteLayers.viirs.enabled) {\n        satelliteLayers.viirs.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      // Add MODIS data\n      if (satelliteLayers.modis.enabled) {\n        satelliteLayers.modis.data.forEach(hotspot => {\n          const intensity = (hotspot.confidence / 100) * (hotspot.intensity / 200);\n          heatmapData.push([hotspot.latitude, hotspot.longitude, intensity]);\n        });\n      }\n\n      if (heatmapData.length > 0) {\n        heatmapLayerRef.current = L.heatLayer(heatmapData, {\n          radius: 20,\n          blur: 15,\n          maxZoom: 17,\n          gradient: {\n            0.4: 'blue',\n            0.6: 'cyan',\n            0.7: 'lime',\n            0.8: 'yellow',\n            1.0: 'red'\n          }\n        }).addTo(map);\n      }\n    }\n  }, [satelliteLayers, loadHeatmapPlugin]);\n\n  const addFirePolygons = useCallback((map, L, fire) => {\n    const { geometry } = fire;\n    \n    try {\n      if (geometry.type === 'Polygon') {\n        const coords = geometry.coordinates[0];\n        \n        if (!coords || coords.length < 3) {\n          console.warn('Invalid polygon coordinates for fire:', fire.name);\n          return;\n        }\n        \n        const leafletCoords = coords\n          .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                  typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                  !isNaN(coord[0]) && !isNaN(coord[1]))\n          .map(coord => [coord[1], coord[0]]);\n        \n        if (leafletCoords.length < 3) {\n          console.warn('Not enough valid coordinates for polygon:', fire.name);\n          return;\n        }\n        \n        const polygon = L.polygon(leafletCoords, {\n          color: '#ef4444',\n          weight: 2,\n          opacity: 0.8,\n          fillColor: '#ef4444',\n          fillOpacity: 0.2\n        }).addTo(map);\n        \n        polygonsRef.current.push(polygon);\n        \n      } else if (geometry.type === 'MultiPolygon') {\n        geometry.coordinates.forEach((polygonCoords, index) => {\n          const coords = polygonCoords[0];\n\n          if (!coords || coords.length < 3) {\n            console.warn(`Invalid polygon coordinates for fire ${fire.name}, polygon ${index}`);\n            return;\n          }\n\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' && \n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          if (leafletCoords.length < 3) {\n            console.warn(`Not enough valid coordinates for polygon ${index} of fire:`, fire.name);\n            return;\n          }\n          \n          const polygon = L.polygon(leafletCoords, {\n            color: '#ef4444',\n            weight: 2,\n            opacity: 0.8,\n            fillColor: '#ef4444',\n            fillOpacity: 0.2\n          }).addTo(map);\n          \n          polygonsRef.current.push(polygon);\n        });\n      }\n    } catch (error) {\n      console.error('Error adding fire polygon for', fire.name, ':', error);\n    }\n  }, []);\n\n  const addFireMarkers = useCallback((map, L) => {\n    // Clear existing markers and polygons\n    markersRef.current.forEach(marker => map.removeLayer(marker));\n    polygonsRef.current.forEach(polygon => map.removeLayer(polygon));\n    markersRef.current = [];\n    polygonsRef.current = [];\n\n    // Add markers for each fire\n    fires.forEach(fire => {\n      // Add polygon outlines\n      addFirePolygons(map, L, fire);\n      \n      // Get icon configuration based on severity\n      const iconConfig = getIconSizeForSeverity(fire.severity);\n      const backgroundColor = getSeverityBackgroundColor(fire.severity);\n      \n      // Create fire icon with dynamic sizing and color\n      const fireIcon = L.divIcon({\n        html: `<div style=\"\n          background: ${backgroundColor};\n          width: ${iconConfig.size}px;\n          height: ${iconConfig.size}px;\n          border-radius: 50%;\n          border: 3px solid white;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.4);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ${iconConfig.fontSize};\n          cursor: pointer;\n        \">🔥</div>`,\n        className: 'fire-marker',\n        iconSize: [iconConfig.size, iconConfig.size],\n        iconAnchor: [iconConfig.size / 2, iconConfig.size / 2],\n        popupAnchor: [0, -iconConfig.size / 2]\n      });\n      \n      // Add marker\n      const marker = L.marker([fire.lat, fire.lng], { icon: fireIcon })\n        .addTo(map)\n        .bindPopup(`\n          <div style=\"color: #374151; font-family: system-ui;\">\n            <h3 style=\"font-weight: bold; font-size: 16px; margin: 0 0 8px 0;\">${fire.name}</h3>\n            <p style=\"margin: 2px 0;\">Size: ${fire.size} acres</p>\n            <p style=\"margin: 2px 0;\">Containment: ${fire.containment ? `${fire.containment}%` : 'N/A'}</p>\n            <p style=\"margin: 2px 0; color: ${getSeverityColorHex(fire.severity)}; font-weight: 600;\">\n              Severity: ${fire.severity}\n            </p>\n            <div style=\"display: flex; gap: 8px; margin-top: 8px;\">\n              <button onclick=\"window.selectFire('${fire.id}')\" style=\"\n                background: #3b82f6;\n                color: white;\n                border: none;\n                padding: 4px 8px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 12px;\n              \">View Details</button>\n            </div>\n          </div>\n        `)\n        .on('click', () => onFireClick(fire));\n\n      markersRef.current.push(marker);\n    });\n  }, [fires, onFireClick, addFirePolygons]);\n\n  // Zoom to fire perimeter\n  const zoomToFire = useCallback((fire) => {\n    console.log('zoomToFire called with:', fire);\n    if (!mapInstanceRef.current || !fire.geometry) {\n      console.log('Early return - mapInstance:', !!mapInstanceRef.current, 'geometry:', !!fire.geometry);\n      return;\n    }\n\n    const L = window.L;\n    try {\n      console.log('Fire geometry type:', fire.geometry.type);\n      if (fire.geometry.type === 'Polygon') {\n        const coords = fire.geometry.coordinates[0];\n        console.log('Polygon coordinates:', coords);\n        if (coords && coords.length >= 3) {\n          const leafletCoords = coords\n            .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                    typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                    !isNaN(coord[0]) && !isNaN(coord[1]))\n            .map(coord => [coord[1], coord[0]]);\n          \n          console.log('Leaflet coordinates:', leafletCoords);\n          if (leafletCoords.length >= 3) {\n            const bounds = L.latLngBounds(leafletCoords);\n            console.log('Fitting bounds:', bounds);\n            mapInstanceRef.current.fitBounds(bounds, { \n              padding: [20, 20],\n              maxZoom: 15 \n            });\n          }\n        }\n      } else if (fire.geometry.type === 'MultiPolygon') {\n        const allCoords = [];\n        fire.geometry.coordinates.forEach(polygonCoords => {\n          const coords = polygonCoords[0];\n          if (coords && coords.length >= 3) {\n            const leafletCoords = coords\n              .filter(coord => Array.isArray(coord) && coord.length >= 2 && \n                      typeof coord[0] === 'number' && typeof coord[1] === 'number' &&\n                      !isNaN(coord[0]) && !isNaN(coord[1]))\n              .map(coord => [coord[1], coord[0]]);\n            allCoords.push(...leafletCoords);\n          }\n        });\n        \n        console.log('MultiPolygon all coordinates:', allCoords);\n        if (allCoords.length >= 3) {\n          const bounds = L.latLngBounds(allCoords);\n          console.log('Fitting bounds:', bounds);\n          mapInstanceRef.current.fitBounds(bounds, { \n            padding: [20, 20],\n            maxZoom: 15 \n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error zooming to fire:', error);\n    }\n  }, [mapInstanceRef]);\n\n  // Cleanup function\n  const cleanup = useCallback(() => {\n    // Disconnect resize observer\n    if (resizeObserverRef.current) {\n      resizeObserverRef.current.disconnect();\n      resizeObserverRef.current = null;\n    }\n\n    // Clean up markers and polygons\n    if (mapInstanceRef.current) {\n      markersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing marker:', e);\n        }\n      });\n      \n      polygonsRef.current.forEach(polygon => {\n        try {\n          mapInstanceRef.current.removeLayer(polygon);\n        } catch (e) {\n          console.warn('Error removing polygon:', e);\n        }\n      });\n\n      // Clean up satellite markers\n      satelliteMarkersRef.current.forEach(marker => {\n        try {\n          mapInstanceRef.current.removeLayer(marker);\n        } catch (e) {\n          console.warn('Error removing satellite marker:', e);\n        }\n      });\n\n      // Clean up heatmap layer\n      if (heatmapLayerRef.current) {\n        try {\n          mapInstanceRef.current.removeLayer(heatmapLayerRef.current);\n        } catch (e) {\n          console.warn('Error removing heatmap layer:', e);\n        }\n      }\n    }\n\n    markersRef.current = [];\n    polygonsRef.current = [];\n    satelliteMarkersRef.current = [];\n    heatmapLayerRef.current = null;\n\n    // Remove map instance\n    if (mapInstanceRef.current) {\n      try {\n        mapInstanceRef.current.remove();\n      } catch (e) {\n        console.warn('Error removing map:', e);\n      }\n      mapInstanceRef.current = null;\n    }\n\n    // Clean up global selectFire function\n    if (window.selectFire) {\n      delete window.selectFire;\n    }\n  }, []);\n\n  useEffect(() => {\n    const loadLeaflet = async () => {\n      try {\n        // Adding CSS\n        if (!document.querySelector('link[href*=\"leaflet\"]')) {\n          const link = document.createElement('link');\n          link.rel = 'stylesheet';\n          link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';\n          document.head.appendChild(link);\n        }\n\n        // Loading Leaflet\n        if (!window.L) {\n          const script = document.createElement('script');\n          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';\n          script.onload = () => {\n            console.log('Leaflet loaded successfully');\n            initializeMap();\n          };\n          script.onerror = () => {\n            console.error('Failed to load Leaflet');\n          };\n          document.head.appendChild(script);\n        } else {\n          initializeMap();\n        }\n      } catch (error) {\n        console.error('Error loading Leaflet:', error);\n      }\n    };\n\n    const initializeMap = async () => {\n      // Clean up existing map first\n      cleanup();\n\n      if (!mapRef.current) return;\n\n      try {\n        const L = window.L;\n        \n        // Initialize the map in San Francisco Bay Area\n        const map = L.map(mapRef.current, {\n          center: [37.7749, -122.4194],\n          zoom: 10,\n          zoomControl: false\n        });\n\n        // Add tile layer\n        const tileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(map);\n\n        mapInstanceRef.current = map;\n        mapInstanceRef.current.tileLayer = tileLayer;\n\n        // Add fire markers when fires are loaded\n        if (fires.length > 0) {\n          addFireMarkers(map, L);\n        }\n\n        // Add satellite data\n        if (satelliteLayers) {\n          addSatelliteMarkers(map, L);\n          await addHeatmapLayer(map, L);\n        }\n\n        // Map resizing with proper error handling\n        if (mapRef.current) {\n          resizeObserverRef.current = new ResizeObserver(() => {\n            try {\n              if (mapInstanceRef.current && mapRef.current) {\n                // Add a small delay to ensure DOM is ready\n                setTimeout(() => {\n                  if (mapInstanceRef.current && mapRef.current) {\n                    mapInstanceRef.current.invalidateSize();\n                  }\n                }, 50);\n              }\n            } catch (error) {\n              console.warn('Error during map resize:', error);\n            }\n          });\n          \n          resizeObserverRef.current.observe(mapRef.current);\n        }\n\n        console.log('Map initialized successfully');\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    };\n\n    loadLeaflet();\n\n    return cleanup;\n  }, [fires.length, mapLayer, addFireMarkers, cleanup, satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Change tiles when map type changes\n  useEffect(() => {\n    if (mapInstanceRef.current && mapInstanceRef.current.tileLayer) {\n      const L = window.L;\n      try {\n        mapInstanceRef.current.removeLayer(mapInstanceRef.current.tileLayer);\n        \n        const newTileLayer = L.tileLayer(getTileUrl(mapLayer), {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(mapInstanceRef.current);\n\n        mapInstanceRef.current.tileLayer = newTileLayer;\n      } catch (error) {\n        console.error('Error changing tile layer:', error);\n      }\n    }\n  }, [mapLayer]);\n\n  // Update markers when fires change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && fires.length > 0) {\n      try {\n        addFireMarkers(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating fire markers:', error);\n      }\n    }\n  }, [fires, addFireMarkers]);\n\n  // Update satellite layers when they change\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L && satelliteLayers) {\n      try {\n        addSatelliteMarkers(mapInstanceRef.current, window.L);\n        addHeatmapLayer(mapInstanceRef.current, window.L);\n      } catch (error) {\n        console.error('Error updating satellite layers:', error);\n      }\n    }\n  }, [satelliteLayers, addSatelliteMarkers, addHeatmapLayer]);\n\n  // Make selectFire global for popup buttons\n  useEffect(() => {\n    window.selectFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          onFireClick(fire);\n        }\n      } catch (error) {\n        console.error('Error in selectFire:', error);\n      }\n    };\n\n    window.zoomToFire = (fireId) => {\n      try {\n        const fire = fires.find(f => f.id === fireId);\n        if (fire) {\n          zoomToFire(fire);\n        }\n      } catch (error) {\n        console.error('Error in zoomToFire:', error);\n      }\n    };\n    \n    return () => {\n      if (window.selectFire) {\n        delete window.selectFire;\n      }\n      if (window.zoomToFire) {\n        delete window.zoomToFire;\n      }\n    };\n  }, [fires, onFireClick, zoomToFire]);\n\n  useImperativeHandle(ref, () => ({\n    zoomToFire,\n  }));\n\n  return (\n    <div \n      ref={mapRef} \n      className=\"w-full h-full\"\n      style={{ minHeight: '500px' }}\n    />\n  );\n});\n\nexport default MapComponent;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}